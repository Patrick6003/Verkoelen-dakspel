<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Vinky V Dakspel (Verbeterd)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #gameCanvas {
      border: 1px solid #000;
      background-color: #595A5C; /* Donkergrijze achtergrond (Verkoelen-stijl) */
      display: block;
      margin-top: 20px;
    }
    #scoreBoard {
      margin-top: 10px;
      font-family: Arial, sans-serif;
    }
    #scoreBoard p {
      margin: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <!-- Popup met uitleg (verschijnt automatisch bij laden van de pagina) -->
  <script>
    window.addEventListener('load', () => {
      alert("Welkom bij het Vinky V Dakspel!\n\n" +
        "De gele kraan is op hol geslagen en laat allerlei dakmaterialen vallen. " +
        "Beweeg Vinky (de oranje V) onderaan om de gasflessen, dakrollen en schroeven te vangen. " +
        "Je verliest een leven als je iets mist. Soms valt er ook een geldzak (power-up) waarmee je tijdelijk groter wordt!\n\n" +
        "Veel plezier!");
    });
  </script>

  <canvas id="gameCanvas" width="400" height="600"></canvas>
  
  <!-- ScoreBoard onder het speelveld: hoeveel van elk ding is gevangen -->
  <div id="scoreBoard">
    <p>
      Gasflessen: <span id="gasflesCount">0</span> | 
      Dakrollen: <span id="dakrolCount">0</span> | 
      Schroeven: <span id="schroefCount">0</span> | 
      Geldzakken: <span id="powerUpCount">0</span>
    </p>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- Speler (Vinky) ---
    let vinkyX = 175;          
    let vinkyY = 550;         
    let vinkyWidth = 50;      
    let vinkyHeight = 50;     
    const originalVinkyWidth = 50;
    const originalVinkyHeight = 50;
    let powerUpActive = false;
    let powerUpTimer = 0;      // Duur (in frames) dat de power-up actief is

    // --- Kraan / haak ---
    const craneHeight = 10;    // Dikte van de gele balk bovenaan
    let hookX = 0;             // Horizontale positie van de haak
    let hookY = craneHeight;   // Haak net onder de gele balk
    let hookWidth = 10;
    let hookHeight = 20;
    let hookSpeed = 2;
    let hookDirection = 1;     // 1 = naar rechts, -1 = naar links

    // --- Objecten ---
    let objects = [];          
    let score = 0;
    let lives = 3;
    let gameOver = false;

    // Counters voor aantal gevangen van elk type
    let gasflesCount = 0;
    let dakrolCount = 0;
    let schroefCount = 0;
    let powerUpCount = 0;  // Geldzakken

    // Typedefinities
    const objectTypes = {
      gasfles: { speed: 2, points: 10, width: 20, height: 40 },
      dakrol:  { speed: 3, points: 20, width: 15, height: 40 },
      schroef: { speed: 4, points: 5,  width: 10, height: 20 },
      powerUp: { speed: 3, points: 0,  width: 20, height: 20 } // Geldzak
    };

    // --- Besturing via touch ---
    canvas.addEventListener('touchmove', function(e) {
      e.preventDefault();
      const touch = e.touches[0];
      vinkyX = touch.clientX - canvas.offsetLeft - vinkyWidth / 2;
      limitVinkyMovement();
    });

    // --- Besturing via muis ---
    canvas.addEventListener('mousemove', function(e) {
      const rect = canvas.getBoundingClientRect();
      vinkyX = e.clientX - rect.left - vinkyWidth / 2;
      limitVinkyMovement();
    });

    function limitVinkyMovement() {
      if (vinkyX < 0) vinkyX = 0;
      if (vinkyX > canvas.width - vinkyWidth) {
        vinkyX = canvas.width - vinkyWidth;
      }
    }

    // --- Opnieuw klikken als game over is ---
    canvas.addEventListener('click', function(e) {
      if (gameOver) {
        const rect = canvas.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const clickY = e.clientY - rect.top;
        if (clickX > 150 && clickX < 250 && clickY > 275 && clickY < 325) {
          restartGame();
        }
      }
    });

    // --- Nieuwe objecten spawnen vanaf de haak ---
    function spawnObject() {
      // ~1% kans per frame
      if (Math.random() < 0.01) {
        let type;
        const rand = Math.random();
        if (rand < 0.02) {
          type = 'powerUp';  // 2% van die 1% kans => 0.02% op geldzak
        } else if (rand < 0.5) {
          type = 'gasfles';
        } else if (rand < 0.8) {
          type = 'dakrol';
        } else {
          type = 'schroef';
        }

        // Het object valt vanaf (ongeveer) de positie van de haak
        const x = hookX + hookWidth / 2 - objectTypes[type].width / 2;
        objects.push({
          type: type,
          x: x,
          y: hookY + hookHeight,
          speed: objectTypes[type].speed,
          points: objectTypes[type].points,
          width: objectTypes[type].width,
          height: objectTypes[type].height
        });
      }
    }

    // --- Haak bewegen (links-rechts) ---
    function updateHook() {
      hookX += hookDirection * hookSpeed;
      // Check randen
      if (hookX < 0) {
        hookX = 0;
        hookDirection = 1;
      } else if (hookX + hookWidth > canvas.width) {
        hookX = canvas.width - hookWidth;
        hookDirection = -1;
      }
    }

    // --- Update objecten (vallen + check vangst) ---
    function updateObjects() {
      for (let i = objects.length - 1; i >= 0; i--) {
        let obj = objects[i];
        obj.y += obj.speed;

        // Check vangst
        if (
          obj.y + obj.height > vinkyY &&
          obj.y < vinkyY + vinkyHeight &&
          obj.x + obj.width > vinkyX &&
          obj.x < vinkyX + vinkyWidth
        ) {
          // Vinky vangt het object
          if (obj.type === 'powerUp') {
            powerUpCount++;
            activatePowerUp();
          } else {
            // Punten + tellers
            score += obj.points;
            if (obj.type === 'gasfles') gasflesCount++;
            if (obj.type === 'dakrol')  dakrolCount++;
            if (obj.type === 'schroef') schroefCount++;
          }
          objects.splice(i, 1);
        }
        // Gemist (onder uit beeld)
        else if (obj.y > canvas.height) {
          if (obj.type !== 'powerUp') {
            lives--;
          }
          objects.splice(i, 1);
        }
      }
    }

    // --- Power-up activeren (grotere Vinky) ---
    function activatePowerUp() {
      powerUpActive = true;
      powerUpTimer = 300; // ~5 seconden bij 60 FPS
      vinkyWidth = 75;
      vinkyHeight = 75;
    }

    // --- Power-up actief houden/timer ---
    function updatePowerUp() {
      if (powerUpActive) {
        powerUpTimer--;
        if (powerUpTimer <= 0) {
          // Power-up is verlopen, terug naar normale afmetingen
          powerUpActive = false;
          vinkyWidth = originalVinkyWidth;
          vinkyHeight = originalVinkyHeight;
        }
      }
    }

    // --- Check of het spel voorbij is ---
    function checkGameOver() {
      if (lives <= 0) {
        gameOver = true;
      }
    }

    // --- Achtergrond tekenen ---
    function drawBackground() {
      // Volledige canvas overschrijven
      ctx.fillStyle = '#595A5C';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // --- Gele kraanbalk bovenaan ---
    function drawCraneBar() {
      ctx.fillStyle = '#FFD700'; // Gougeel
      ctx.fillRect(0, 0, canvas.width, craneHeight);
    }

    // --- Haak tekenen ---
    function drawHook() {
      // Touw/lijn
      ctx.strokeStyle = '#808080';
      ctx.beginPath();
      // vanuit midden van de haak tot bovenaan de balk
      ctx.moveTo(hookX + hookWidth / 2, 0);
      ctx.lineTo(hookX + hookWidth / 2, hookY);
      ctx.stroke();

      // Zelfde kleur voor de haak
      ctx.fillStyle = '#808080';
      ctx.fillRect(hookX, hookY, hookWidth, hookHeight);
    }

    // --- Plat dak onderaan (simpele grijze balk) ---
    function drawFlatRoof() {
      ctx.fillStyle = '#444';
      ctx.fillRect(0, 580, canvas.width, 20);
    }

    // --- Vinky V tekenen (oranje V met “uitsparing”) ---
    function drawVinkyV() {
      ctx.save();
      // Verplaats naar middelpunt van Vinky
      ctx.translate(vinkyX + vinkyWidth / 2, vinkyY + vinkyHeight / 2);
      
      // Grote oranje driehoek (V)
      ctx.fillStyle = '#F36F21';
      ctx.beginPath();
      ctx.moveTo(-vinkyWidth / 2, -vinkyHeight / 2);  // linkerboven
      ctx.lineTo(0, vinkyHeight / 2);                // punt onder
      ctx.lineTo(vinkyWidth / 2, -vinkyHeight / 2);  // rechterboven
      ctx.closePath();
      ctx.fill();

      // Kleinere driehoek in achtergrondkleur, zodat het meer op een V lijkt
      ctx.fillStyle = '#595A5C';
      ctx.beginPath();
      // iets minder breed dan de hoofddriehoek en iets vanaf de top, 
      // zodat de ogen vrij blijven
      ctx.moveTo(-vinkyWidth * 0.3, -vinkyHeight / 2);
      ctx.lineTo(0, vinkyHeight * 0.2);
      ctx.lineTo(vinkyWidth * 0.3, -vinkyHeight / 2);
      ctx.closePath();
      ctx.fill();

      // Ogen (boven de ‘uitsparing’)
      ctx.fillStyle = '#FFFFFF';
      // linkeroog
      ctx.beginPath();
      ctx.arc(-vinkyWidth * 0.25, -vinkyHeight * 0.1, 4, 0, 2 * Math.PI);
      ctx.fill();
      // rechteroog
      ctx.beginPath();
      ctx.arc(vinkyWidth * 0.25, -vinkyHeight * 0.1, 4, 0, 2 * Math.PI);
      ctx.fill();

      // Pupillen (blauw)
      ctx.fillStyle = '#0000FF';
      ctx.beginPath();
      ctx.arc(-vinkyWidth * 0.25, -vinkyHeight * 0.1, 2, 0, 2 * Math.PI);
      ctx.arc(vinkyWidth * 0.25, -vinkyHeight * 0.1, 2, 0, 2 * Math.PI);
      ctx.fill();

      ctx.restore();
    }

    // --- Vallende objecten tekenen ---
    function drawObjects() {
      for (let obj of objects) {
        if (obj.type === 'gasfles') {
          // Grijze gasfles
          ctx.fillStyle = '#A9A9A9';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
          // Kop van de gasfles
          ctx.fillStyle = '#7F7F7F';
          ctx.fillRect(obj.x + obj.width / 4, obj.y - 5, obj.width / 2, 5);

        } else if (obj.type === 'dakrol') {
          // Zwarte rechthoek met witte band
          ctx.fillStyle = '#000000';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
          ctx.fillStyle = '#FFFFFF';
          ctx.fillRect(obj.x, obj.y + obj.height / 2 - 2, obj.width, 4);

        } else if (obj.type === 'schroef') {
          // Blauwe kop + grijze steel
          ctx.fillStyle = '#0000FF';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height * 0.4);
          ctx.fillStyle = '#C0C0C0';
          ctx.fillRect(
            obj.x + obj.width / 4,
            obj.y + obj.height * 0.4,
            obj.width / 2,
            obj.height * 0.6
          );

        } else if (obj.type === 'powerUp') {
          // Geldzak
          const centerX = obj.x + obj.width / 2;
          const centerY = obj.y + obj.height / 2;
          const radius = obj.width / 2;

          // Zak-ovaal
          ctx.fillStyle = '#8B4513'; // bruin
          ctx.beginPath();
          ctx.ellipse(centerX, centerY + 2, radius, radius * 1.2, 0, 0, Math.PI * 2);
          ctx.fill();

          // Bovenkant van de zak
          ctx.fillStyle = '#654321';
          ctx.fillRect(centerX - radius * 0.6, centerY - radius * 0.6, radius * 1.2, radius * 0.4);

          // Een simpel geld-teken erop (bijv. € of $)
          ctx.fillStyle = '#FFFF00';
          ctx.font = '10px Arial';
          ctx.fillText('€', centerX - 3, centerY + 4);
        }
      }
    }

    // --- Score & levens tekenen (optioneel in canvas) ---
    function drawScore() {
      ctx.font = '20px Arial';
      ctx.fillStyle = '#FFFFFF';
      ctx.fillText('Score: ' + score, 10, 70);
    }

    function drawLives() {
      ctx.font = '20px Arial';
      ctx.fillStyle = '#FFFFFF';
      ctx.fillText('Levens: ' + lives, 10, 95);
    }

    // --- Opnieuw-knop tekenen ---
    function drawRestartButton() {
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(150, 275, 100, 50);
      ctx.fillStyle = '#003087';
      ctx.font = '20px Arial';
      ctx.fillText('Opnieuw', 165, 305);
    }

    // --- ScoreBoard in de DOM updaten ---
    function updateScoreBoard() {
      document.getElementById('gasflesCount').textContent = gasflesCount;
      document.getElementById('dakrolCount').textContent = dakrolCount;
      document.getElementById('schroefCount').textContent = schroefCount;
      document.getElementById('powerUpCount').textContent = powerUpCount;
    }

    // --- Herstart het spel ---
    function restartGame() {
      score = 0;
      lives = 3;
      objects = [];
      powerUpActive = false;
      powerUpTimer = 0;
      vinkyWidth = originalVinkyWidth;
      vinkyHeight = originalVinkyHeight;
      vinkyX = 175;
      hookX = 0;
      gameOver = false;

      // Reset ook de counters
      gasflesCount = 0;
      dakrolCount = 0;
      schroefCount = 0;
      powerUpCount = 0;
    }

    // --- Hoofd-loop ---
    function gameLoop() {
      if (!gameOver) {
        // Update
        updateHook();
        spawnObject();
        updateObjects();
        updatePowerUp();
        checkGameOver();

        // Teken
        drawBackground();
        drawCraneBar();
        drawHook();
        drawFlatRoof();
        drawVinkyV();
        drawObjects();
        drawScore();
        drawLives();

        // ScoreBoard in DOM bijwerken
        updateScoreBoard();

      } else {
        // Laat het canvas leeg zien + "Opnieuw" knop
        drawBackground();
        drawRestartButton();
      }
      requestAnimationFrame(gameLoop);
    }

    // Start de gameloop
    gameLoop();
  </script>
</body>
</html>

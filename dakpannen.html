<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Vinky V Dakspel (Uitgebreide Aanpassingen)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Menu / Highscore / Pauzeknop bovenaan */
    #topBar {
      width: 100%;
      max-width: 400px;
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: Arial, sans-serif;
    }
    #highScoreLabel {
      font-size: 14px;
      margin: 0 10px;
    }
    #pauseBtn {
      margin: 0 10px;
      font-size: 14px;
      padding: 4px 8px;
      cursor: pointer;
    }

    /* Canvas is in "echte" pixels 400×600, maar schaalt naar max 400px breed */
    canvas {
      border: 1px solid #000;
      width: 100%;
      max-width: 400px;
      height: auto;
      display: block;
      margin-top: 10px;
      background-color: #595A5C; /* fallback, maar we overschrijven in drawBackground() */
    }
    #scoreBoard {
      margin-top: 10px;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #scoreBoard p {
      margin: 5px;
      font-size: 16px;
    }
    #gameInfo {
      max-width: 400px;
      font-family: Arial, sans-serif;
      font-size: 14px;
      background-color: #eee;
      padding: 10px;
      margin-bottom: 20px;
      text-align: left;
    }
  </style>
</head>
<body>

  <!-- Bovenbalk met Highscore en Pauzeknop -->
  <div id="topBar">
    <div id="highScoreLabel">Highscore: <span id="highScoreSpan">0</span></div>
    <button id="pauseBtn">Pauze</button>
  </div>

  <!-- Beknopte uitleg -->
  <div id="gameInfo">
    <strong>Levels:</strong><br/>
    - Level 1 (&lt; 1000): Normaal<br/>
    - Level 2 (&ge; 1000): Kraan beweegt willekeurig<br/>
    - Level 3 (&ge; 1500): Kraan hangt lager<br/>
    - Level 4 (&ge; 2000): Kraan nóg lager<br/>
    - Level 5 (&ge; 3000): Wind & mist<br/>
    - Level 6 (&ge; 4000): Donker (je ziet nog minder)<br/><br/>
    <strong>Objecten:</strong><br/>
    - Gasfles: 15 punten<br/>
    - Dakrol: 30 punten<br/>
    - Schroef: 10 punten<br/>
    - PIR-plaat: 25 punten<br/>
    - Salaris (geldzak): +1 leven<br/><br/>
    Vang alles; mis je iets, dan verlies je een leven. Je hebt ook een pauzeknop bovenaan!
  </div>

  <canvas id="gameCanvas" width="400" height="600"></canvas>

  <!-- ScoreBoard onder het spel -->
  <div id="scoreBoard">
    <p>
      Gasflessen: <span id="gasflesCount">0</span> |
      Dakrollen: <span id="dakrolCount">0</span> |
      Schroeven: <span id="schroefCount">0</span> |
      PIR-platen: <span id="pirCount">0</span> |
      Salaris: <span id="powerUpCount">0</span>
    </p>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- Audio ---
    // Vervang 'catch.mp3' en 'miss.mp3' door de juiste paden / geluidsbestanden.
    const catchSound = new Audio('catch.mp3'); // geluid bij vangst
    const missSound  = new Audio('miss.mp3');  // geluid bij missen

    // --- Pauze --- 
    let paused = false;
    const pauseBtn = document.getElementById('pauseBtn');
    pauseBtn.addEventListener('click', () => {
      paused = !paused;
      pauseBtn.textContent = paused ? 'Ga verder' : 'Pauze';
    });

    // --- Highscore via localStorage ---
    let highScore = 0;
    if (localStorage.getItem('vinkyHighScore')) {
      highScore = parseInt(localStorage.getItem('vinkyHighScore'), 10);
    }
    const highScoreSpan = document.getElementById('highScoreSpan');
    highScoreSpan.textContent = highScore.toString();

    function updateHighScoreIfNeeded() {
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('vinkyHighScore', highScore.toString());
        highScoreSpan.textContent = highScore;
      }
    }

    // --- Speler (Vinky) ---
    let vinkyX = 175;
    let vinkyY = 550;
    let vinkyWidth = 50;
    let vinkyHeight = 50;

    // Kleine witte "handschoenen" aan de zijkanten van V
    // (We tekenen 2 kleine cirkels bij de bovenhoeken)
    // Afhankelijk van vinkyWidth, vinkyHeight.

    // --- Moeilijkheidslevels ---
    let currentLevel = 1;

    // --- Kraan / Haak ---
    const craneHeight = 10;
    let hookX = 0;
    let hookY = craneHeight;
    let hookWidth = 10;
    let hookHeight = 20;
    let hookSpeed = 2;
    let hookDirection = 1; // 1=rechts, -1=links
    let randomCraneTimer = 0;

    // --- Wind / Mist (level 5) + Donker (level 6) ---
    let windSpeed = 0;
    let windDirection = 1;
    let windChangeTimer = 0;

    // --- Objecten ---
    let objects = [];
    let score = 0;
    let lives = 3;
    let gameOver = false;

    // Counters
    let gasflesCount = 0;
    let dakrolCount = 0;
    let schroefCount = 0;
    let pirCount = 0;
    let powerUpCount = 0;

    // Nieuw: Alles krijgt "iets meer punten"
    // - Gasfles: 15
    // - Dakrol: 30
    // - Schroef: 10
    // - PIR: 25
    // - Salaris: 0 (maar wel +1 leven)
    const objectTypes = {
      gasfles: { points: 15, width: 20, height: 40 },
      dakrol:  { points: 30, width: 15, height: 40 },
      schroef: { points: 10, width: 10, height: 20 },
      pir:     { points: 25, width: 30, height: 20 },
      powerUp: { points: 0,  width: 20, height: 20 } // Salaris
    };

    // --- Wolken: we laten ze bewegen van rechts naar links ---
    // We definiëren een array met (x, y, size). 
    let clouds = [
      { x: 60,  y: 70,  size: 1.0 },
      { x: 200, y: 50,  size: 1.2 },
      { x: 300, y: 80,  size: 1.1 }
    ];

    // --- Besturing via touch + muis (alleen x) ---
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (e.touches.length > 0) moveVinky(e.touches[0].clientX);
    });
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      if (e.touches.length > 0) moveVinky(e.touches[0].clientX);
    });
    canvas.addEventListener('mousemove', e => {
      moveVinky(e.clientX);
    });

    function moveVinky(clientX) {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;

      // geen “langzamer” of “sneller” meer volgens de nieuwe eisen
      let desiredX = (clientX - rect.left) * scaleX - vinkyWidth / 2;
      vinkyX = desiredX;

      // Grenzen
      if (vinkyX < 0) vinkyX = 0;
      if (vinkyX > canvas.width - vinkyWidth) {
        vinkyX = canvas.width - vinkyWidth;
      }
    }

    // --- Klik voor opnieuw bij game over ---
    canvas.addEventListener('click', e => {
      if (gameOver) {
        const rect = canvas.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const clickY = e.clientY - rect.top;
        // bounding box v/d 'Opnieuw'-knop
        if (clickX > 150 && clickX < 250 && clickY > 275 && clickY < 325) {
          restartGame();
        }
      }
    });

    // --- Levels (nu t/m 6) ---
    function updateLevel() {
      if (score >= 4000) {
        currentLevel = 6; // Donker
      } else if (score >= 3000) {
        currentLevel = 5; // Wind + mist
      } else if (score >= 2000) {
        currentLevel = 4; // Kraan nóg lager
      } else if (score >= 1500) {
        currentLevel = 3; // Kraan hangt lager
      } else if (score >= 1000) {
        currentLevel = 2; // Kraan random
      } else {
        currentLevel = 1;
      }
    }

    // --- Objecten spawnen; iets sneller (basis ~3) en meer variatie per level ---
    function spawnObject() {
      if (Math.random() < 0.01) {
        let type;
        const rand = Math.random();
        // Kansverdeling
        if (rand < 0.02) {
          type = 'powerUp';
        } else if (rand < 0.17) {
          type = 'gasfles';
        } else if (rand < 0.47) {
          type = 'dakrol';
        } else if (rand < 0.80) {
          type = 'pir';
        } else {
          type = 'schroef';
        }

        // Snelheid: base=3, plus random tot ...
        // Hoe hoger het level, hoe groter de random marge
        let baseSpeed = 3; // start
        let variation = 0;
        if (currentLevel === 1) {
          variation = 0.5; 
        } else if (currentLevel === 2) {
          variation = 1.0;
        } else if (currentLevel === 3) {
          variation = 1.5;
        } else if (currentLevel === 4) {
          variation = 2.0;
        } else if (currentLevel === 5) {
          variation = 3.0;
        } else {
          // level 6
          variation = 4.0;
        }
        let finalSpeed = baseSpeed + Math.random() * variation;

        // Kraan-lager effect
        let effectiveHookY = hookY + hookHeight;
        if (currentLevel === 3) {
          effectiveHookY += 30;
        } else if (currentLevel >= 4) {
          effectiveHookY += 60;
        }

        const x = hookX + hookWidth / 2 - objectTypes[type].width / 2;
        objects.push({
          type:   type,
          x:      x,
          y:      effectiveHookY,
          speed:  finalSpeed,
          points: objectTypes[type].points,
          width:  objectTypes[type].width,
          height: objectTypes[type].height
        });
      }
    }

    // --- Haak bewegen (level 2 => random) ---
    function updateHook() {
      // gewone horizontale beweging
      hookX += hookDirection * hookSpeed;
      // randen
      if (hookX < 0) {
        hookX = 0;
        hookDirection = 1;
      } else if (hookX + hookWidth > canvas.width) {
        hookX = canvas.width - hookWidth;
        hookDirection = -1;
      }

      // vanaf level 2: kraan random
      if (currentLevel >= 2) {
        randomCraneTimer--;
        if (randomCraneTimer <= 0) {
          randomCraneTimer = 60 + Math.floor(Math.random() * 60);
          hookDirection = (Math.random() < 0.5) ? 1 : -1;
          hookSpeed = 2 + Math.random() * 2;
        }
      }
    }

    // --- Objecten updaten (wind op level 5, level 6 => donker overlay) ---
    function updateObjects() {
      for (let i = objects.length - 1; i >= 0; i--) {
        let obj = objects[i];

        // wind
        if (currentLevel >= 5 && windSpeed !== 0) {
          obj.x += windSpeed * windDirection;
          if (obj.x < 0) obj.x = 0;
          if (obj.x + obj.width > canvas.width) {
            obj.x = canvas.width - obj.width;
          }
        }

        // vallen
        obj.y += obj.speed;

        // vangst?
        if (
          obj.y + obj.height > vinkyY &&
          obj.y < vinkyY + vinkyHeight &&
          obj.x + obj.width > vinkyX &&
          obj.x < vinkyX + vinkyWidth
        ) {
          // vangst
          if (obj.type === 'powerUp') {
            // +1 leven
            lives++;
            powerUpCount++;
          } else {
            // punten + telling
            score += obj.points;
            if (obj.type === 'gasfles')  gasflesCount++;
            if (obj.type === 'dakrol')   dakrolCount++;
            if (obj.type === 'schroef')  schroefCount++;
            if (obj.type === 'pir')      pirCount++;
          }
          // geluid catch
          catchSound.currentTime = 0;
          catchSound.play().catch(()=>{});
          objects.splice(i, 1);
        }
        // gemist?
        else if (obj.y > canvas.height) {
          if (obj.type !== 'powerUp') {
            lives--;
            // geluid miss
            missSound.currentTime = 0;
            missSound.play().catch(()=>{});
          }
          objects.splice(i, 1);
        }
      }
    }

    // --- Wolken bewegen van rechts naar links ---
    function moveClouds() {
      for (let c of clouds) {
        // Hoe snel? ca. 0.3 px/frame?
        let speed = 0.2; 
        c.x -= speed; 
        // Als de wolk uit beeld is, zet 'm rechts weer neer
        if (c.x < -50) {
          c.x = canvas.width + 30; 
        }
      }
    }

    // --- Wind & Mist (level 5), plus level 6 => donkerder ---
    function updateWindAndMist() {
      if (currentLevel < 5) {
        windSpeed = 0;
      } else {
        if (windSpeed === 0) {
          windSpeed = 0.3;
        }
        windChangeTimer--;
        if (windChangeTimer <= 0) {
          windChangeTimer = 120 + Math.floor(Math.random() * 120);
          windDirection = (Math.random() < 0.5) ? 1 : -1;
          windSpeed = 0.2 + Math.random() * 0.5;
        }
      }
    }

    // --- Check Game Over ---
    function checkGameOver() {
      if (lives <= 0 && !gameOver) {
        // Pop-up
        alert(`Game Over! Je score is: ${score}`);
        gameOver = true;
        // Highscore bijwerken
        updateHighScoreIfNeeded();
      }
    }

    // --- Achtergrond tekenen: blauwe lucht, gras, wolken, zon ---
    function drawBackground() {
      // Lucht
      ctx.fillStyle = '#87CEEB';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Zon (rechtsboven)
      ctx.fillStyle = '#FFD700';
      ctx.beginPath();
      ctx.arc(canvas.width - 50, 50, 30, 0, 2*Math.PI);
      ctx.fill();

      // Wolken
      for (let c of clouds) {
        drawCloud(c.x, c.y, c.size);
      }

      // Gras
      ctx.fillStyle = '#228B22';
      ctx.fillRect(0, 500, canvas.width, 100);

      // Mist (level 5) => grijze overlay
      if (currentLevel === 5) {
        ctx.fillStyle = 'rgba(200,200,200,0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
      // Level 6 => nog donkerder
      if (currentLevel >= 6) {
        // Donkere overlay
        ctx.fillStyle = 'rgba(0,0,0,0.4)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }
    }
    function drawCloud(cx, cy, size=1.0) {
      // Simpele, 3 cirkels
      ctx.fillStyle = '#FFFFFF';
      ctx.beginPath();
      ctx.arc(cx, cy, 20*size, 0, 2*Math.PI);
      ctx.arc(cx+15*size, cy, 25*size, 0, 2*Math.PI);
      ctx.arc(cx-15*size, cy+10*size, 25*size, 0, 2*Math.PI);
      ctx.fill();
    }

    // --- Gele kraanbalk ---
    function drawCraneBar() {
      ctx.fillStyle = '#FFD700';
      ctx.fillRect(0, 0, canvas.width, craneHeight);
    }

    // --- Haak ---
    function drawHook() {
      ctx.strokeStyle = '#808080';
      ctx.beginPath();
      ctx.moveTo(hookX + hookWidth/2, 0);
      ctx.lineTo(hookX + hookWidth/2, hookY);
      ctx.stroke();

      ctx.fillStyle = '#808080';
      ctx.fillRect(hookX, hookY, hookWidth, hookHeight);
    }

    // --- Plat dak (onderaan) ---
    function drawFlatRoof() {
      ctx.fillStyle = '#444';
      ctx.fillRect(0, 580, canvas.width, 20);
    }

    // --- Vinky V (met witte handjes) ---
    function drawVinkyV() {
      ctx.save();
      ctx.translate(vinkyX + vinkyWidth/2, vinkyY + vinkyHeight/2);

      // Oranje V
      ctx.fillStyle = '#F36F21';
      ctx.beginPath();
      ctx.moveTo(-vinkyWidth/2, -vinkyHeight/2);
      ctx.lineTo(0, vinkyHeight/2);
      ctx.lineTo(vinkyWidth/2, -vinkyHeight/2);
      ctx.closePath();
      ctx.fill();

      // Uitsparing (groen van het gras)
      ctx.fillStyle = '#228B22';
      ctx.beginPath();
      ctx.moveTo(-vinkyWidth * 0.2, -vinkyHeight/2);
      ctx.lineTo(0, vinkyHeight*0.15);
      ctx.lineTo(vinkyWidth*0.2, -vinkyHeight/2);
      ctx.closePath();
      ctx.fill();

      // Ogen
      ctx.fillStyle = '#FFFFFF';
      ctx.beginPath();
      ctx.arc(-vinkyWidth*0.25, -vinkyHeight*0.1, 4, 0, 2*Math.PI);
      ctx.fill();
      ctx.beginPath();
      ctx.arc(vinkyWidth*0.25, -vinkyHeight*0.1, 4, 0, 2*Math.PI);
      ctx.fill();

      ctx.fillStyle = '#0000FF';
      ctx.beginPath();
      ctx.arc(-vinkyWidth*0.25, -vinkyHeight*0.1, 2, 0, 2*Math.PI);
      ctx.arc(vinkyWidth*0.25, -vinkyHeight*0.1, 2, 0, 2*Math.PI);
      ctx.fill();

      // Linker handje
      ctx.fillStyle = '#FFFFFF';
      ctx.beginPath();
      ctx.arc(-vinkyWidth/2 - 5, -vinkyHeight/4, 5, 0, 2*Math.PI);
      ctx.fill();

      // Rechter handje
      ctx.beginPath();
      ctx.arc(vinkyWidth/2 + 5, -vinkyHeight/4, 5, 0, 2*Math.PI);
      ctx.fill();

      ctx.restore();
    }

    // --- Vallende objecten tekenen ---
    function drawObjects() {
      for (let obj of objects) {
        if (obj.type === 'gasfles') {
          ctx.fillStyle = '#A9A9A9';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
          ctx.fillStyle = '#7F7F7F';
          ctx.fillRect(obj.x + obj.width/4, obj.y - 5, obj.width/2, 5);

        } else if (obj.type === 'dakrol') {
          ctx.fillStyle = '#000000';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
          ctx.fillStyle = '#FFFFFF';
          ctx.fillRect(obj.x, obj.y + obj.height/2 - 2, obj.width, 4);

        } else if (obj.type === 'schroef') {
          ctx.fillStyle = '#0000FF';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height*0.4);
          ctx.fillStyle = '#C0C0C0';
          ctx.fillRect(
            obj.x + obj.width/4,
            obj.y + obj.height*0.4,
            obj.width/2,
            obj.height*0.6
          );

        } else if (obj.type === 'pir') {
          ctx.fillStyle = '#EEE8AA';
          ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
          ctx.strokeStyle = '#BDB76B';
          ctx.strokeRect(obj.x, obj.y, obj.width, obj.height);

        } else if (obj.type === 'powerUp') {
          // Salaris
          const centerX = obj.x + obj.width/2;
          const centerY = obj.y + obj.height/2;
          const radius = obj.width/2;

          ctx.fillStyle = '#8B4513';
          ctx.beginPath();
          ctx.ellipse(centerX, centerY+2, radius, radius*1.2, 0, 0, 2*Math.PI);
          ctx.fill();

          ctx.fillStyle = '#654321';
          ctx.fillRect(centerX - radius*0.6, centerY - radius*0.6, radius*1.2, radius*0.4);

          // Label
          ctx.fillStyle = '#FFFF00';
          ctx.font = '10px Arial';
          ctx.fillText('+1', centerX - 6, centerY + 4);
        }
      }
    }

    // --- Score & Levens (zwarte tekst) ---
    function drawScore() {
      ctx.font = '20px Arial';
      ctx.fillStyle = '#000000';
      ctx.fillText('Score: ' + score, 10, 70);
    }
    function drawLives() {
      ctx.font = '20px Arial';
      ctx.fillStyle = '#000000';
      ctx.fillText('Levens: ' + lives, 10, 95);
    }

    // --- Opnieuw-knop ---
    function drawRestartButton() {
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(150, 275, 100, 50);
      ctx.fillStyle = '#003087';
      ctx.font = '20px Arial';
      ctx.fillText('Opnieuw', 165, 305);
    }

    // --- ScoreBoard in DOM ---
    function updateScoreBoard() {
      document.getElementById('gasflesCount').textContent = gasflesCount;
      document.getElementById('dakrolCount').textContent = dakrolCount;
      document.getElementById('schroefCount').textContent = schroefCount;
      document.getElementById('pirCount').textContent = pirCount;
      document.getElementById('powerUpCount').textContent = powerUpCount;
    }

    // --- Herstart ---
    function restartGame() {
      score = 0;
      lives = 3;
      objects = [];
      gameOver = false;
      currentLevel = 1;

      hookX = 0;
      hookSpeed = 2;
      hookDirection = 1;
      randomCraneTimer = 0;

      windSpeed = 0;
      windDirection = 1;
      windChangeTimer = 0;

      vinkyX = 175;

      gasflesCount = 0;
      dakrolCount = 0;
      schroefCount = 0;
      pirCount = 0;
      powerUpCount = 0;
    }

    // --- Hoofd-gameloop ---
    function gameLoop() {
      if (!paused) {
        if (!gameOver) {
          updateLevel();
          updateHook();
          spawnObject();
          updateObjects();
          updateWindAndMist();
          moveClouds();
          checkGameOver();
        }
      }
      // Tekenfase (ook als paused = true, zodat je de pauze stand ziet)
      drawBackground();
      drawCraneBar();
      drawHook();
      drawFlatRoof();
      drawVinkyV();
      drawObjects();
      drawScore();
      drawLives();

      if (gameOver) {
        drawRestartButton();
      }

      updateScoreBoard();
      requestAnimationFrame(gameLoop);
    }

    // Start
    gameLoop();
  </script>
</body>
</html>

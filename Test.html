<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DakVormCalculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .input-section, .schets-section {
            flex: 1;
            min-width: 300px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007BFF;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #resultaat {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .vorm-specifiek {
            display: none;
        }
        canvas {
            border: 1px solid #ccc;
            margin-top: 10px;
            width: 100%;
            max-width: 400px;
            height: 400px;
        }
        .detail-input {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .detail-input select, .detail-input input[type="text"] {
            flex: 1;
        }
        .warning {
            color: red;
            font-size: 14px;
            margin-top: -5px;
        }
    </style>
</head>
<body>
    <h1>DakVormCalculator</h1>
    <div class="container">
        <div class="input-section">
            <form id="dakForm">
                <label for="vorm">Dakvorm:</label>
                <select id="vorm" onchange="updateAlles()">
                    <option value="rechthoek">â¬œ Rechthoek</option>
                    <option value="l-vorm">ðŸ¡’ L-vorm</option>
                </select>

                <!-- Rechthoek -->
                <div id="rechthoek" class="vorm-specifiek">
                    <label for="lengte">Lengte (m):</label>
                    <input type="number" id="lengte" step="0.1" min="0" value="10" oninput="updateAlles()">
                    <label for="breedte">Breedte (m):</label>
                    <input type="number" id="breedte" step="0.1" min="0" value="5" oninput="updateAlles()">
                    <label>Detailomschrijvingen (4 zijden):</label>
                    <div class="detail-input">
                        <select id="detail1" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="oms1" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="detail2" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="oms2" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="detail3" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="oms3" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="detail4" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="oms4" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                </div>

                <!-- L-vorm -->
                <div id="l-vorm" class="vorm-specifiek">
                    <label for="lengte1">Lengte deel 1 (m):</label>
                    <input type="number" id="lengte1" step="0.1" min="0" value="10" oninput="updateAlles()">
                    <label for="breedte1">Breedte deel 1 (m):</label>
                    <input type="number" id="breedte1" step="0.1" min="0" value="5" oninput="updateAlles()">
                    <label for="lengte2">Lengte deel 2 (m):</label>
                    <input type="number" id="lengte2" step="0.1" min="0" value="4" oninput="updateAlles()">
                    <div id="l-vorm-warning" class="warning"></div>
                    <label for="breedte2">Breedte deel 2 (m):</label>
                    <input type="number" id="breedte2" step="0.1" min="0" value="3" oninput="updateAlles()">
                    <label>Detailomschrijvingen (6 zijden):</label>
                    <div class="detail-input">
                        <select id="l-detail1" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="l-oms1" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="l-detail2" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="l-oms2" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="l-detail3" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="l-oms3" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="l-detail4" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="l-oms4" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="l-detail5" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="l-oms5" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                    <div class="detail-input">
                        <select id="l-detail6" oninput="updateAlles()">
                            <option value="">Kies detail</option>
                            <option value="Lood">Lood</option>
                            <option value="Afwerkstrook">Afwerkstrook</option>
                            <option value="Lichtkoepel">Lichtkoepel</option>
                            <option value="Opgaandwerk">Opgaandwerk</option>
                        </select>
                        <input type="text" id="l-oms6" placeholder="Extra omschrijving" oninput="updateAlles()">
                    </div>
                </div>

                <label for="hellingsgraad">Hellingsgraad (Â°):</label>
                <input type="number" id="hellingsgraad" step="0.1" min="0" max="90" value="0" oninput="updateAlles()">
                <button type="button" onclick="resetForm()">Reset</button>
                <button type="button" onclick="exportPNG()">Export PNG</button>
                <button type="button" onclick="exportPDF()">Export PDF</button>
                <button type="button" onclick="zoomIn()">Zoom In</button>
                <button type="button" onclick="zoomOut()">Zoom Uit</button>
            </form>
            <div id="resultaat"></div>
        </div>
        <div class="schets-section">
            <h3>Schets</h3>
            <canvas id="dakCanvas"></canvas>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        const canvas = document.getElementById('dakCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 400;
        let zoom = 1;

        const kleuren = {
            "Lood": "#FF0000",
            "Afwerkstrook": "#00FF00",
            "Lichtkoepel": "#0000FF",
            "Opgaandwerk": "#FFA500",
            "": "#000000"
        };

        function updateAlles() {
            const vorm = document.getElementById('vorm').value;
            const hellingsgraad = parseFloat(document.getElementById('hellingsgraad').value) || 0;
            let oppervlakte = 0, omtrek = 0, lengtes = [], omschrijvingen = [], detailsList = [];

            document.getElementById('rechthoek').style.display = vorm === 'rechthoek' ? 'block' : 'none';
            document.getElementById('l-vorm').style.display = vorm === 'l-vorm' ? 'block' : 'none';

            if (vorm === 'rechthoek') {
                const lengte = parseFloat(document.getElementById('lengte').value) || 0;
                const breedte = parseFloat(document.getElementById('breedte').value) || 0;
                oppervlakte = lengte * breedte;
                omtrek = 2 * (lengte + breedte);
                lengtes = [lengte, breedte, lengte, breedte];
                detailsList = [1, 2, 3, 4].map(i => ({
                    detail: document.getElementById(`detail${i}`).value,
                    oms: document.getElementById(`oms${i}`).value || ''
                }));
                omschrijvingen = detailsList.map(d => d.detail + (d.oms ? ` - ${d.oms}` : ''));
                tekenRechthoek(lengte, breedte, detailsList);
            } else if (vorm === 'l-vorm') {
                const lengte1 = parseFloat(document.getElementById('lengte1').value) || 0;
                const breedte1 = parseFloat(document.getElementById('breedte1').value) || 0;
                const lengte2 = parseFloat(document.getElementById('lengte2').value) || 0;
                const breedte2 = parseFloat(document.getElementById('breedte2').value) || 0;
                const warningDiv = document.getElementById('l-vorm-warning');
                if (lengte2 > lengte1) {
                    warningDiv.textContent = "Waarschuwing: Lengte deel 2 mag niet groter zijn dan Lengte deel 1!";
                    return;
                } else {
                    warningDiv.textContent = "";
                }
                oppervlakte = (lengte1 * breedte1) + (lengte2 * breedte2);
                omtrek = lengte1 + breedte1 + lengte2 + (breedte1 + breedte2) + (lengte1 - lengte2) + breedte2;
                lengtes = [lengte1, breedte1, lengte2, breedte1 + breedte2, lengte1 - lengte2, breedte2];
                detailsList = [1, 2, 3, 4, 5, 6].map(i => ({
                    detail: document.getElementById(`l-detail${i}`).value,
                    oms: document.getElementById(`l-oms${i}`).value || ''
                }));
                omschrijvingen = detailsList.map(d => d.detail + (d.oms ? ` - ${d.oms}` : ''));
                tekenLVorm(lengte1, breedte1, lengte2, breedte2, detailsList);
            }

            if (hellingsgraad > 0) {
                const cosinus = Math.cos(hellingsgraad * Math.PI / 180);
                oppervlakte = oppervlakte / cosinus;
            }

            const details = somDetailnummers(lengtes, omschrijvingen);

            const resultaatDiv = document.getElementById('resultaat');
            let detailText = '<h4>Details:</h4><ul>';
            for (const [oms, lengte] of Object.entries(details)) {
                detailText += `<li>${oms}: ${lengte.toFixed(2)} m</li>`;
            }
            detailText += '</ul>';
            resultaatDiv.innerHTML = `
                <h3>Resultaat</h3>
                <p>Oppervlakte: ${oppervlakte.toFixed(2)} mÂ²</p>
                <p>Totale omtrek: ${omtrek.toFixed(2)} m</p>
                ${detailText}
            `;
        }

        function somDetailnummers(lengtes, omschrijvingen) {
            const details = {};
            lengtes.forEach((lengte, index) => {
                const oms = omschrijvingen[index];
                details[oms] = (details[oms] || 0) + lengte;
            });
            return details;
        }

        function tekenRechthoek(lengte, breedte, detailsList) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const schaal = Math.min(350 / lengte, 350 / breedte) * zoom || zoom;
            const x = (canvas.width - lengte * schaal) / 2;
            const y = (canvas.height - breedte * schaal) / 2;
            const lijnen = [
                [x, y, x + lengte * schaal, y, lengte], // Boven
                [x + lengte * schaal, y, x + lengte * schaal, y + breedte * schaal, breedte], // Rechts
                [x + lengte * schaal, y + breedte * schaal, x, y + breedte * schaal, lengte], // Onder
                [x, y + breedte * schaal, x, y, breedte] // Links
            ];
            lijnen.forEach((lijn, i) => {
                ctx.beginPath();
                ctx.moveTo(lijn[0], lijn[1]);
                ctx.lineTo(lijn[2], lijn[3]);
                ctx.strokeStyle = kleuren[detailsList[i].detail] || '#000000';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            tekenNummersEnLabels(lijnen, detailsList);
        }

        function tekenLVorm(lengte1, breedte1, lengte2, breedte2, detailsList) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const schaal = Math.min(350 / lengte1, 350 / (breedte1 + breedte2)) * zoom || zoom;
            const x = (canvas.width - lengte1 * schaal) / 2;
            const y = (canvas.height - (breedte1 + breedte2) * schaal) / 2;
            const lijnen = [
                [x, y, x + lengte1 * schaal, y, lengte1],
                [x + lengte1 * schaal, y, x + lengte1 * schaal, y + breedte1 * schaal, breedte1],
                [x + lengte1 * schaal, y + breedte1 * schaal, x + (lengte1 - lengte2) * schaal, y + breedte1 * schaal, lengte2],
                [x + (lengte1 - lengte2) * schaal, y + breedte1 * schaal, x + (lengte1 - lengte2) * schaal, y + (breedte1 + breedte2) * schaal, breedte1 + breedte2],
                [x + (lengte1 - lengte2) * schaal, y + (breedte1 + breedte2) * schaal, x, y + (breedte1 + breedte2) * schaal, lengte1 - lengte2],
                [x, y + (breedte1 + breedte2) * schaal, x, y, breedte2]
            ];
            lijnen.forEach((lijn, i) => {
                ctx.beginPath();
                ctx.moveTo(lijn[0], lijn[1]);
                ctx.lineTo(lijn[2], lijn[3]);
                ctx.strokeStyle = kleuren[detailsList[i].detail] || '#000000';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            tekenNummersEnLabels(lijnen, detailsList);
        }

        function tekenNummersEnLabels(lijnen, detailsList) {
            ctx.font = '12px Arial';
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            lijnen.forEach((lijn, i) => {
                const middenX = (lijn[0] + lijn[2]) / 2;
                const middenY = (lijn[1] + lijn[3]) / 2;
                ctx.fillStyle = 'red';
                ctx.fillText(i + 1, middenX, middenY - 10);
                ctx.fillStyle = 'black';
                ctx.fillText(`${lijn[4].toFixed(1)}m`, middenX, middenY + 10);
            });
        }

        function zoomIn() {
            zoom *= 1.2;
            updateAlles();
        }

        function zoomOut() {
            zoom /= 1.2;
            if (zoom < 0.5) zoom = 0.5;
            updateAlles();
        }

        function exportPNG() {
            html2canvas(document.querySelector('.container')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'dakvorm.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function exportPDF() {
            html2canvas(document.querySelector('.container')).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF();
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save('dakvorm.pdf');
            });
        }

        function resetForm() {
            document.getElementById('dakForm').reset();
            document.getElementById('lengte').value = 10;
            document.getElementById('breedte').value = 5;
            document.getElementById('lengte1').value = 10;
            document.getElementById('breedte1').value = 5;
            document.getElementById('lengte2').value = 4;
            document.getElementById('breedte2').value = 3;
            document.getElementById('hellingsgraad').value = 0;
            document.getElementById('l-vorm-warning').textContent = '';
            zoom = 1;
            updateAlles();
        }

        // Initiele weergave
        updateAlles();
    </script>
</body>
</html>

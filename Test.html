<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DakVormCalculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #222;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        .input-section, .schets-section {
            min-width: 0;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .tab-button {
            background-color: #ddd;
            padding: 8px 16px;
            border: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
        }
        .tab-button.active {
            background-color: #007BFF;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: #222;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #888;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fff;
            color: #333;
        }
        .error {
            color: #d32f2f;
            font-size: 12px;
            margin-top: -5px;
            display: none;
        }
        button {
            background-color: #007BFF;
            color: #fff;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #resultaat {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #888;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .vorm-specifiek {
            display: none;
        }
        canvas {
            border: 1px solid #888;
            margin-top: 10px;
            width: 100%;
            max-width: 400px;
            height: 400px;
            background-color: #fff;
        }
        .detail-input {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        .detail-input select, .detail-input input[type="text"] {
            flex: 1;
        }
        .legenda {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #888;
            border-radius: 4px;
        }
        .legenda-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legenda-kleur {
            width: 15px;
            height: 15px;
            display: inline-block;
        }
        .checkbox-group {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>DakVormCalculator</h1>
    <div class="container">
        <div class="input-section">
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('invoer')" aria-label="Invoertabblad">Invoer</button>
                <button class="tab-button" onclick="switchTab('waarnemingen')" aria-label="Waarnemingen tabblad">Waarnemingen</button>
            </div>
            <div id="invoer" class="tab-content active">
                <form id="dakForm">
                    <label for="daknaam">Daknaam:</label>
                    <input type="text" id="daknaam" placeholder="Bijv. Dak Noord" aria-label="Naam van het dak" value="Dak 1" oninput="syncDaknaam()">
                    <label for="vorm">Dakvorm:</label>
                    <select id="vorm" onchange="updateAlles()" aria-label="Kies dakvorm">
                        <option value="rechthoek">â¬œ Rechthoek</option>
                        <option value="l-vorm">ðŸ¡’ L-vorm</option>
                    </select>

                    <!-- Rechthoek -->
                    <div id="rechthoek" class="vorm-specifiek">
                        <label for="lengte">Lengte (m) - Zijden 1 en 3:</label>
                        <input type="number" id="lengte" step="0.1" value="10" oninput="validateInput(this); updateAlles()" aria-label="Lengte van het dak in meters, zijden 1 en 3">
                        <div id="lengte-error" class="error">Voer een getal groter dan 0 in</div>
                        <label for="breedte">Breedte (m) - Zijden 2 en 4:</label>
                        <input type="number" id="breedte" step="0.1" value="5" oninput="validateInput(this); updateAlles()" aria-label="Breedte van het dak in meters, zijden 2 en 4">
                        <div id="breedte-error" class="error">Voer een getal groter dan 0 in</div>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="indicatief" oninput="updateAlles()" aria-label="Afmetingen zijn indicatief"> Afmetingen indicatief</label>
                        </div>
                        <label>Detailomschrijvingen (4 zijden):</label>
                        <div class="detail-input">
                            <select id="detail1" oninput="updateAlles()" aria-label="Detail voor zijde 1">
                                <option value="">Kies detail (1)</option>
                                <option value="Lood">Lood (1)</option>
                                <option value="Afwerkstrook">Afwerkstrook (1)</option>
                                <option value="Dilatatie">Dilatatie (1)</option>
                                <option value="Dakpannen">Dakpannen (1)</option>
                                <option value="Overig">Overig (1)</option>
                                <option value="Verschillende">Verschillende (1)</option>
                                <option value="Opgaandwerk">Opgaandwerk (1)</option>
                            </select>
                            <input type="text" id="oms1" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 1">
                        </div>
                        <div class="detail-input">
                            <select id="detail2" oninput="updateAlles()" aria-label="Detail voor zijde 2">
                                <option value="">Kies detail (2)</option>
                                <option value="Lood">Lood (2)</option>
                                <option value="Afwerkstrook">Afwerkstrook (2)</option>
                                <option value="Dilatatie">Dilatatie (2)</option>
                                <option value="Dakpannen">Dakpannen (2)</option>
                                <option value="Overig">Overig (2)</option>
                                <option value="Verschillende">Verschillende (2)</option>
                                <option value="Opgaandwerk">Opgaandwerk (2)</option>
                            </select>
                            <input type="text" id="oms2" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 2">
                        </div>
                        <div class="detail-input">
                            <select id="detail3" oninput="updateAlles()" aria-label="Detail voor zijde 3">
                                <option value="">Kies detail (3)</option>
                                <option value="Lood">Lood (3)</option>
                                <option value="Afwerkstrook">Afwerkstrook (3)</option>
                                <option value="Dilatatie">Dilatatie (3)</option>
                                <option value="Dakpannen">Dakpannen (3)</option>
                                <option value="Overig">Overig (3)</option>
                                <option value="Verschillende">Verschillende (3)</option>
                                <option value="Opgaandwerk">Opgaandwerk (3)</option>
                            </select>
                            <input type="text" id="oms3" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 3">
                        </div>
                        <div class="detail-input">
                            <select id="detail4" oninput="updateAlles()" aria-label="Detail voor zijde 4">
                                <option value="">Kies detail (4)</option>
                                <option value="Lood">Lood (4)</option>
                                <option value="Afwerkstrook">Afwerkstrook (4)</option>
                                <option value="Dilatatie">Dilatatie (4)</option>
                                <option value="Dakpannen">Dakpannen (4)</option>
                                <option value="Overig">Overig (4)</option>
                                <option value="Verschillende">Verschillende (4)</option>
                                <option value="Opgaandwerk">Opgaandwerk (4)</option>
                            </select>
                            <input type="text" id="oms4" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 4">
                        </div>
                    </div>

                    <!-- L-vorm -->
                    <div id="l-vorm" class="vorm-specifiek">
                        <label for="lengte1">Lengte deel 1 (m) - Zijden 1 en 5:</label>
                        <input type="number" id="lengte1" step="0.1" value="10" oninput="validateInput(this); updateAlles()" aria-label="Lengte deel 1 van L-vorm in meters, zijden 1 en 5">
                        <div id="lengte1-error" class="error">Voer een getal groter dan 0 in</div>
                        <label for="breedte1">Breedte deel 1 (m) - Zijden 2 en 6:</label>
                        <input type="number" id="breedte1" step="0.1" value="5" oninput="validateInput(this); updateAlles()" aria-label="Breedte deel 1 van L-vorm in meters, zijden 2 en 6">
                        <div id="breedte1-error" class="error">Voer een getal groter dan 0 in</div>
                        <label for="lengte2">Lengte deel 2 (m) - Zijde 3:</label>
                        <input type="number" id="lengte2" step="0.1" value="4" oninput="validateInput(this); updateAlles()" aria-label="Lengte deel 2 van L-vorm in meters, zijde 3">
                        <div id="lengte2-error" class="error">Voer een getal groter dan 0 in of kleiner dan Lengte deel 1</div>
                        <label for="breedte2">Breedte deel 2 (m) - Zijde 4:</label>
                        <input type="number" id="breedte2" step="0.1" value="3" oninput="validateInput(this); updateAlles()" aria-label="Breedte deel 2 van L-vorm in meters, zijde 4">
                        <div id="breedte2-error" class="error">Voer een getal groter dan 0 in</div>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="indicatief" oninput="updateAlles()" aria-label="Afmetingen zijn indicatief"> Afmetingen indicatief</label>
                        </div>
                        <label>Detailomschrijvingen (6 zijden):</label>
                        <div class="detail-input">
                            <select id="l-detail1" oninput="updateAlles()" aria-label="Detail voor zijde 1 van L-vorm">
                                <option value="">Kies detail (1 - Lengte deel 1)</option>
                                <option value="Lood">Lood (1)</option>
                                <option value="Afwerkstrook">Afwerkstrook (1)</option>
                                <option value="Dilatatie">Dilatatie (1)</option>
                                <option value="Dakpannen">Dakpannen (1)</option>
                                <option value="Overig">Overig (1)</option>
                                <option value="Verschillende">Verschillende (1)</option>
                                <option value="Opgaandwerk">Opgaandwerk (1)</option>
                            </select>
                            <input type="text" id="l-oms1" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 1 van L-vorm">
                        </div>
                        <div class="detail-input">
                            <select id="l-detail2" oninput="updateAlles()" aria-label="Detail voor zijde 2 van L-vorm">
                                <option value="">Kies detail (2 - Breedte deel 1)</option>
                                <option value="Lood">Lood (2)</option>
                                <option value="Afwerkstrook">Afwerkstrook (2)</option>
                                <option value="Dilatatie">Dilatatie (2)</option>
                                <option value="Dakpannen">Dakpannen (2)</option>
                                <option value="Overig">Overig (2)</option>
                                <option value="Verschillende">Verschillende (2)</option>
                                <option value="Opgaandwerk">Opgaandwerk (2)</option>
                            </select>
                            <input type="text" id="l-oms2" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 2 van L-vorm">
                        </div>
                        <div class="detail-input">
                            <select id="l-detail3" oninput="updateAlles()" aria-label="Detail voor zijde 3 van L-vorm">
                                <option value="">Kies detail (3 - Lengte deel 2)</option>
                                <option value="Lood">Lood (3)</option>
                                <option value="Afwerkstrook">Afwerkstrook (3)</option>
                                <option value="Dilatatie">Dilatatie (3)</option>
                                <option value="Dakpannen">Dakpannen (3)</option>
                                <option value="Overig">Overig (3)</option>
                                <option value="Verschillende">Verschillende (3)</option>
                                <option value="Opgaandwerk">Opgaandwerk (3)</option>
                            </select>
                            <input type="text" id="l-oms3" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 3 van L-vorm">
                        </div>
                        <div class="detail-input">
                            <select id="l-detail4" oninput="updateAlles()" aria-label="Detail voor zijde 4 van L-vorm">
                                <option value="">Kies detail (4 - Breedte deel 2)</option>
                                <option value="Lood">Lood (4)</option>
                                <option value="Afwerkstrook">Afwerkstrook (4)</option>
                                <option value="Dilatatie">Dilatatie (4)</option>
                                <option value="Dakpannen">Dakpannen (4)</option>
                                <option value="Overig">Overig (4)</option>
                                <option value="Verschillende">Verschillende (4)</option>
                                <option value="Opgaandwerk">Opgaandwerk (4)</option>
                            </select>
                            <input type="text" id="l-oms4" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 4 van L-vorm">
                        </div>
                        <div class="detail-input">
                            <select id="l-detail5" oninput="updateAlles()" aria-label="Detail voor zijde 5 van L-vorm">
                                <option value="">Kies detail (5 - Lengte deel 1 - Lengte deel 2)</option>
                                <option value="Lood">Lood (5)</option>
                                <option value="Afwerkstrook">Afwerkstrook (5)</option>
                                <option value="Dilatatie">Dilatatie (5)</option>
                                <option value="Dakpannen">Dakpannen (5)</option>
                                <option value="Overig">Overig (5)</option>
                                <option value="Verschillende">Verschillende (5)</option>
                                <option value="Opgaandwerk">Opgaandwerk (5)</option>
                            </select>
                            <input type="text" id="l-oms5" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 5 van L-vorm">
                        </div>
                        <div class="detail-input">
                            <select id="l-detail6" oninput="updateAlles()" aria-label="Detail voor zijde 6 van L-vorm">
                                <option value="">Kies detail (6 - Breedte deel 1 + Breedte deel 2)</option>
                                <option value="Lood">Lood (6)</option>
                                <option value="Afwerkstrook">Afwerkstrook (6)</option>
                                <option value="Dilatatie">Dilatatie (6)</option>
                                <option value="Dakpannen">Dakpannen (6)</option>
                                <option value="Overig">Overig (6)</option>
                                <option value="Verschillende">Verschillende (6)</option>
                                <option value="Opgaandwerk">Opgaandwerk (6)</option>
                            </select>
                            <input type="text" id="l-oms6" placeholder="Extra omschrijving" oninput="updateAlles()" aria-label="Extra omschrijving voor zijde 6 van L-vorm">
                        </div>
                        <label for="spiegel">Spiegel L-vorm:</label>
                        <input type="checkbox" id="spiegel" oninput="updateAlles()" aria-label="Spiegel de L-vorm schets horizontaal">
                    </div>

                    <label for="hellingsgraad">Hellingsgraad (Â°):</label>
                    <input type="number" id="hellingsgraad" step="0.1" min="0" max="90" value="0" oninput="validateInput(this, true); updateAlles()" aria-label="Hellingsgraad van het dak in graden">
                    <div id="hellingsgraad-error" class="error">Voer een getal tussen 0 en 90 in</div>
                    <button type="button" onclick="resetForm()" aria-label="Formulier resetten">Reset</button>
                    <button type="button" onclick="exportPNG('invoer')" aria-label="Exporteren als PNG">Export PNG</button>
                    <button type="button" onclick="exportPDF('invoer')" aria-label="Exporteren als PDF">Export PDF</button>
                    <button type="button" onclick="zoomIn()" aria-label="Inzoomen op schets">Zoom In</button>
                    <button type="button" onclick="zoomOut()" aria-label="Uitzoomen op schets">Zoom Uit</button>
                </form>
                <div id="resultaat" role="region" aria-live="polite"></div>
            </div>
            <div id="waarnemingen" class="tab-content">
                <label for="daknaam-waarnemingen">Daknaam:</label>
                <input type="text" id="daknaam-waarnemingen" readonly aria-label="Naam van het dak" value="Dak 1">
                <label for="dakhoogte">Dakhoogte (m, indien bekend):</label>
                <input type="number" id="dakhoogte" step="0.1" min="0" placeholder="Bijv. 5.5" aria-label="Hoogte van het dak in meters">
                <label for="dakopbouw">Dakopbouw:</label>
                <textarea id="dakopbouw" rows="3" placeholder="Bijv. Bitumen, isolatie, grind" aria-label="Beschrijving van de dakopbouw"></textarea>
                <label for="gebreken">Gebreken:</label>
                <textarea id="gebreken" rows="3" placeholder="Bijv. Scheuren, lekkages" aria-label="Geconstateerde gebreken op het dak"></textarea>
                <label for="details">Details (ontluchtingen, afvoeren, noodafvoeren):</label>
                <textarea id="details" rows="3" placeholder="Bijv. 2 ontluchtingen, 1 afvoer" aria-label="Details van ontluchtingen, afvoeren en noodafvoeren"></textarea>
                <label for="situatie-omgeving">Situatie/Omgeving:</label>
                <textarea id="situatie-omgeving" rows="3" placeholder="Bijv. Nabij bomen, stedelijk gebied" aria-label="Opmerkingen over situatie en omgeving"></textarea>
                <label for="waarnemingen-extra">Extra waarnemingen:</label>
                <textarea id="waarnemingen-extra" rows="3" placeholder="Bijv. Toegankelijkheid, bijzonderheden" aria-label="Extra waarnemingen over het dak"></textarea>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="grind-vast" aria-label="Grind zit vast"> Grind zit vast</label>
                    <label><input type="checkbox" id="isolatie-nat" aria-label="Isolatie is nat"> Isolatie is nat</label>
                </div>
                <label for="toestand">Algemene onderhoudsstaat (NEN 2767):</label>
                <select id="toestand" aria-label="Algemene onderhoudsstaat van het dak volgens NEN 2767">
                    <option value="1">1 - Uitstekend</option>
                    <option value="2">2 - Goed</option>
                    <option value="3">3 - Redelijk</option>
                    <option value="4">4 - Matig</option>
                    <option value="5">5 - Slecht</option>
                    <option value="6">6 - Zeer slecht</option>
                </select>
                <button type="button" onclick="exportPNG('waarnemingen')" aria-label="Exporteren als PNG met waarnemingen">Export PNG</button>
                <button type="button" onclick="exportPDF('waarnemingen')" aria-label="Exporteren als PDF met waarnemingen">Export PDF</button>
            </div>
        </div>
        <div class="schets-section">
            <h3>Schets</h3>
            <canvas id="dakCanvas" aria-label="Schets van het dakvlak"></canvas>
            <div id="schets-beschrijving" class="visually-hidden" aria-live="polite"></div>
            <div class="legenda" role="region" aria-label="Legenda van de schets">
                <h4>Legenda</h4>
                <div id="legenda-content"></div>
            </div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        const canvas = document.getElementById('dakCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 400;
        canvas.height = 400;
        let zoom = 1;

        const kleuren = {
            "Lood": "#FF4136",
            "Afwerkstrook": "#2ECC40",
            "Dilatatie": "#7FDBFF",
            "Dakpannen": "#FFDC00",
            "Overig": "#AAAAAA",
            "Verschillende": "#B10DC9",
            "Opgaandwerk": "#FF851B",
            "": "#333333"
        };

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
        }

        function syncDaknaam() {
            const daknaamInvoer = document.getElementById('daknaam');
            const daknaamWaarnemingen = document.getElementById('daknaam-waarnemingen');
            daknaamWaarnemingen.value = daknaamInvoer.value;
            updateAlles();
        }

        function validateInput(input, allowZero = false) {
            const value = parseFloat(input.value);
            const errorDiv = document.getElementById(`${input.id}-error`);
            let isValid = !isNaN(value) && (allowZero ? value >= 0 : value > 0);
            if (input.id === 'hellingsgraad') isValid = isValid && value <= 90;
            if (input.id === 'lengte2') {
                const lengte1 = parseFloat(document.getElementById('lengte1').value) || 0;
                isValid = isValid && value <= lengte1;
            }
            errorDiv.style.display = isValid ? 'none' : 'block';
            return isValid;
        }

        function updateAlles() {
            const vorm = document.getElementById('vorm').value;
            const daknaam = document.getElementById('daknaam').value;
            const hellingsgraad = parseFloat(document.getElementById('hellingsgraad').value) || 0;
            const spiegel = document.getElementById('spiegel')?.checked || false;
            const indicatief = document.getElementById('indicatief')?.checked || false;
            let oppervlakte = 0, omtrek = 0, lengtes = [], omschrijvingen = [], detailsList = [];

            document.getElementById('rechthoek').style.display = vorm === 'rechthoek' ? 'block' : 'none';
            document.getElementById('l-vorm').style.display = vorm === 'l-vorm' ? 'block' : 'none';

            let isValid = true;
            const inputs = vorm === 'rechthoek' ? ['lengte', 'breedte', 'hellingsgraad'] : ['lengte1', 'breedte1', 'lengte2', 'breedte2', 'hellingsgraad'];
            inputs.forEach(id => {
                if (!validateInput(document.getElementById(id), id === 'hellingsgraad')) isValid = false;
            });
            if (!isValid) return;

            if (vorm === 'rechthoek') {
                const lengte = parseFloat(document.getElementById('lengte').value) || 0;
                const breedte = parseFloat(document.getElementById('breedte').value) || 0;
                oppervlakte = lengte * breedte;
                omtrek = 2 * (lengte + breedte);
                lengtes = [lengte, breedte, lengte, breedte];
                detailsList = [1, 2, 3, 4].map(i => ({
                    detail: document.getElementById(`detail${i}`).value,
                    oms: document.getElementById(`oms${i}`).value || ''
                }));
                omschrijvingen = detailsList.map(d => d.detail + (d.oms ? ` - ${d.oms}` : ''));
                tekenRechthoek(lengte, breedte, detailsList, oppervlakte, omtrek, hellingsgraad);
            } else if (vorm === 'l-vorm') {
                const lengte1 = parseFloat(document.getElementById('lengte1').value) || 0;
                const breedte1 = parseFloat(document.getElementById('breedte1').value) || 0;
                const lengte2 = parseFloat(document.getElementById('lengte2').value) || 0;
                const breedte2 = parseFloat(document.getElementById('breedte2').value) || 0;
                const lengte5 = lengte1 - lengte2;
                const lengte4 = breedte2;
                oppervlakte = (lengte1 * lengte2) + (lengte5 * lengte4);
                omtrek = lengte1 + breedte1 + lengte2 + breedte2 + lengte5 + (breedte1 + breedte2);
                lengtes = [lengte1, breedte1, lengte2, breedte2, lengte5, breedte1 + breedte2];
                detailsList = [1, 2, 3, 4, 5, 6].map(i => ({
                    detail: document.getElementById(`l-detail${i}`).value,
                    oms: document.getElementById(`l-oms${i}`).value || ''
                }));
                omschrijvingen = detailsList.map(d => d.detail + (d.oms ? ` - ${d.oms}` : ''));
                tekenLVorm(lengte1, breedte1, lengte2, breedte2, detailsList, spiegel, oppervlakte, omtrek, hellingsgraad);
            }

            if (hellingsgraad > 0) {
                const cosinus = Math.cos(hellingsgraad * Math.PI / 180);
                oppervlakte = oppervlakte / cosinus;
            }

            const resultaatDiv = document.getElementById('resultaat');
            let detailText = '<h4>Details:</h4><ul>';
            detailsList.forEach((d, i) => {
                const oms = d.detail + (d.oms ? ` - ${d.oms}` : '');
                detailText += `<li>${i + 1}: ${oms}: ${lengtes[i].toFixed(2)} m</li>`;
            });
            detailText += '</ul>';
            resultaatDiv.innerHTML = `
                <h3>Resultaat - ${daknaam}</h3>
                <p>Oppervlakte: ${oppervlakte.toFixed(2)} mÂ²${indicatief ? ' (indicatief)' : ''}</p>
                <p>Totale omtrek: ${omtrek.toFixed(2)} m${indicatief ? ' (indicatief)' : ''}</p>
                ${detailText}
            `;

            updateLegenda(detailsList, lengtes);
            updateSchetsBeschrijving(vorm, lengtes, omschrijvingen, daknaam, spiegel, indicatief);
        }

        function somDetailnummers(lengtes, omschrijvingen) {
            const details = {};
            lengtes.forEach((lengte, index) => {
                const oms = omschrijvingen[index];
                details[oms] = (details[oms] || 0) + lengte;
            });
            return details;
        }

        function drawGrid() {
            ctx.beginPath();
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 0.5;
            for (let i = 0; i <= canvas.width; i += 20 * zoom) {
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
            }
            for (let i = 0; i <= canvas.height; i += 20 * zoom) {
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
            }
            ctx.stroke();
        }

        function tekenRechthoek(lengte, breedte, detailsList, oppervlakte, omtrek, hellingsgraad) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            const schaal = Math.min(350 / lengte, 350 / breedte) * zoom || zoom;
            const x = (canvas.width - lengte * schaal) / 2;
            const y = (canvas.height - breedte * schaal) / 2;
            const lijnen = [
                [x, y, x + lengte * schaal, y, lengte], // 1: Boven
                [x + lengte * schaal, y, x + lengte * schaal, y + breedte * schaal, breedte], // 2: Rechts
                [x + lengte * schaal, y + breedte * schaal, x, y + breedte * schaal, lengte], // 3: Onder
                [x, y + breedte * schaal, x, y, breedte] // 4: Links
            ];
            lijnen.forEach((lijn, i) => {
                ctx.beginPath();
                ctx.moveTo(lijn[0], lijn[1]);
                ctx.lineTo(lijn[2], lijn[3]);
                ctx.strokeStyle = kleuren[detailsList[i].detail] || '#333333';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            tekenNummersEnLabels(lijnen, detailsList);
            const fontSize = Math.max(16 * zoom, 12);
            ctx.font = `${fontSize}px Arial`;
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText(`${oppervlakte.toFixed(2)} mÂ²`, canvas.width / 2, canvas.height / 2 - fontSize);
            ctx.fillText(`${omtrek.toFixed(2)} m`, canvas.width / 2, canvas.height / 2);
            if (hellingsgraad > 0) {
                ctx.fillText(`${hellingsgraad.toFixed(1)}Â°`, canvas.width / 2, canvas.height / 2 + fontSize);
            }
        }

        function tekenLVorm(lengte1, breedte1, lengte2, breedte2, detailsList, spiegel, oppervlakte, omtrek, hellingsgraad) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            const schaal = Math.min(350 / lengte1, 350 / (breedte1 + breedte2)) * zoom || zoom;
            const x = (canvas.width - lengte1 * schaal) / 2;
            const y = (canvas.height - (breedte1 + breedte2) * schaal) / 2;
            let lijnen;
            if (!spiegel) {
                lijnen = [
                    [x, y, x + lengte1 * schaal, y, lengte1], // 1: Lengte deel 1 (boven)
                    [x + lengte1 * schaal, y, x + lengte1 * schaal, y + breedte1 * schaal, breedte1], // 2: Breedte deel 1 (rechts)
                    [x + lengte1 * schaal, y + breedte1 * schaal, x + (lengte1 - lengte2) * schaal, y + breedte1 * schaal, lengte2], // 3: Lengte deel 2 (midden rechts)
                    [x + (lengte1 - lengte2) * schaal, y + breedte1 * schaal, x + (lengte1 - lengte2) * schaal, y + (breedte1 + breedte2) * schaal, breedte2], // 4: Breedte deel 2 (midden onder)
                    [x + (lengte1 - lengte2) * schaal, y + (breedte1 + breedte2) * schaal, x, y + (breedte1 + breedte2) * schaal, lengte1 - lengte2], // 5: Lengte deel 1 - Lengte deel 2 (onder)
                    [x, y + (breedte1 + breedte2) * schaal, x, y, breedte1 + breedte2] // 6: Breedte deel 1 + Breedte deel 2 (links)
                ];
            } else {
                lijnen = [
                    [x + lengte1 * schaal, y, x, y, lengte1], // 1: Lengte deel 1 (boven, gespiegeld)
                    [x, y, x, y + breedte1 * schaal, breedte1], // 2: Breedte deel 1 (links)
                    [x, y + breedte1 * schaal, x + lengte2 * schaal, y + breedte1 * schaal, lengte2], // 3: Lengte deel 2 (midden links)
                    [x + lengte2 * schaal, y + breedte1 * schaal, x + lengte2 * schaal, y + (breedte1 + breedte2) * schaal, breedte2], // 4: Breedte deel 2 (midden onder)
                    [x + lengte2 * schaal, y + (breedte1 + breedte2) * schaal, x + lengte1 * schaal, y + (breedte1 + breedte2) * schaal, lengte1 - lengte2], // 5: Lengte deel 1 - Lengte deel 2 (onder)
                    [x + lengte1 * schaal, y + (breedte1 + breedte2) * schaal, x + lengte1 * schaal, y, breedte1 + breedte2] // 6: Breedte deel 1 + Breedte deel 2 (rechts)
                ];
            }
            lijnen.forEach((lijn, i) => {
                ctx.beginPath();
                ctx.moveTo(lijn[0], lijn[1]);
                ctx.lineTo(lijn[2], lijn[3]);
                ctx.strokeStyle = kleuren[detailsList[i].detail] || '#333333';
                ctx.lineWidth = 2;
                ctx.stroke();
            });
            tekenNummersEnLabels(lijnen, detailsList);
            const fontSize = Math.max(16 * zoom, 12);
            ctx.font = `${fontSize}px Arial`;
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.fillText(`${oppervlakte.toFixed(2)} mÂ²`, canvas.width / 2, canvas.height / 2 - fontSize);
            ctx.fillText(`${omtrek.toFixed(2)} m`, canvas.width / 2, canvas.height / 2);
            if (hellingsgraad > 0) {
                ctx.fillText(`${hellingsgraad.toFixed(1)}Â°`, canvas.width / 2, canvas.height / 2 + fontSize);
            }
        }

        function tekenNummersEnLabels(lijnen, detailsList) {
            ctx.font = '12px Arial';
            ctx.fillStyle = '#000';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            lijnen.forEach((lijn, i) => {
                const middenX = (lijn[0] + lijn[2]) / 2;
                const middenY = (lijn[1] + lijn[3]) / 2;
                ctx.fillStyle = '#D81B60';
                ctx.fillText(i + 1, middenX, middenY - 10);
                ctx.fillStyle = '#000';
                ctx.fillText(`${lijn[4].toFixed(1)}m`, middenX, middenY + 10);
            });
        }

        function updateLegenda(detailsList, lengtes) {
            const legendaContent = document.getElementById('legenda-content');
            const groupedDetails = {};
            detailsList.forEach((d, i) => {
                const oms = d.detail + (d.oms ? ` - ${d.oms}` : '');
                if (!groupedDetails[oms]) {
                    groupedDetails[oms] = { lengte: 0, kleur: kleuren[d.detail] || '#333333', zijden: [] };
                }
                groupedDetails[oms].lengte += lengtes[i];
                groupedDetails[oms].zijden.push(i + 1);
            });
            let html = '';
            for (const [oms, data] of Object.entries(groupedDetails)) {
                html += `<div class="legenda-item"><span class="legenda-kleur" style="background-color: ${data.kleur}"></span> ${data.zijden.join(', ')}: ${oms} - ${data.lengte.toFixed(2)} m</div>`;
            }
            legendaContent.innerHTML = html;
        }

        function updateSchetsBeschrijving(vorm, lengtes, omschrijvingen, daknaam, spiegel, indicatief) {
            const beschrijving = document.getElementById('schets-beschrijving');
            let text = `Schets van ${daknaam}, een ${vorm === 'rechthoek' ? 'rechthoekig' : 'L-vormig'} dak${vorm === 'l-vorm' && spiegel ? ' (gespiegeld)' : ''}${indicatief ? ' met indicatieve afmetingen' : ''}. `;
            lengtes.forEach((lengte, i) => {
                text += `Zijde ${i + 1}: ${lengte.toFixed(1)} meter, detail: ${omschrijvingen[i]}. `;
            });
            beschrijving.textContent = text;
        }

        function zoomIn() {
            zoom *= 1.2;
            updateAlles();
        }

        function zoomOut() {
            zoom /= 1.2;
            if (zoom < 0.5) zoom = 0.5;
            updateAlles();
        }

        function exportPNG(tabId) {
            switchTab(tabId);
            setTimeout(() => {
                html2canvas(document.querySelector('.container')).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `${document.getElementById('daknaam').value || 'dakvorm'}_${tabId}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }, 100);
        }

        function exportPDF(tabId) {
            switchTab(tabId);
            setTimeout(() => {
                html2canvas(document.querySelector('.container'), { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF();
                    const imgProps = pdf.getImageProperties(imgData);
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                    pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                    pdf.save(`${document.getElementById('daknaam').value || 'dakvorm'}_${tabId}.pdf`);
                });
            }, 100);
        }

        function resetForm() {
            document.getElementById('dakForm').reset();
            document.getElementById('lengte').value = 10;
            document.getElementById('breedte').value = 5;
            document.getElementById('lengte1').value = 10;
            document.getElementById('breedte1').value = 5;
            document.getElementById('lengte2').value = 4;
            document.getElementById('breedte2').value = 3;
            document.getElementById('hellingsgraad').value = 0;
            document.getElementById('daknaam').value = "Dak 1";
            document.getElementById('daknaam-waarnemingen').value = "Dak 1";
            document.getElementById('toestand').value = "1";
            document.getElementById('spiegel').checked = false;
            document.getElementById('indicatief').checked = false;
            document.getElementById('grind-vast').checked = false;
            document.getElementById('isolatie-nat').checked = false;
            document.querySelectorAll('.error').forEach(e => e.style.display = 'none');
            zoom = 1;
            updateAlles();
        }

        // Initiele weergave
        updateAlles();
    </script>
</body>
</html>

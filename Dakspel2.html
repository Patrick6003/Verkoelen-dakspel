<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Verkoelen Dakspecialiste Game</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #87CEEB; /* Luchtblauwe achtergrond */
      font-family: Arial, sans-serif;
    }
    #gameContainer {
      text-align: center;
      margin-top: 20px;
    }
    #gameCanvas {
      background: #87CEEB; /* Blauwe lucht */
      display: block;
      margin: 0 auto;
      border: 2px solid #333;
    }
    .gameButton {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    #scoreBoard {
      font-size: 18px;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas" width="800" height="400">
    Je browser ondersteunt geen canvas. Probeer een moderne browser.
  </canvas>
  <br>
  <button class="gameButton" onclick="startGame()">Start</button>
  <button class="gameButton" onclick="pauseGame()">Pauze</button>
  <button class="gameButton" onclick="resetGame()">Opnieuw</button>
  <div id="scoreBoard">
    Score: <span id="scoreValue">0</span> | Level: <span id="levelValue">1</span>
  </div>
</div>

<script>
  // -----------------------------------------------
  // Canvas en context ophalen
  // -----------------------------------------------
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // -----------------------------------------------
  // Game-variabelen
  // -----------------------------------------------
  let gameRunning = false;
  let gamePaused = false;

  let score = 0;
  let level = 1;
  let frames = 0;        // Houdt bij hoeveel frames er verstreken zijn (voor spawn-logica)
  let speedMultiplier = 1;  // Wordt groter bij hogere levels

  // Oranje bus
  const bus = {
    x: 100, // vaste x-positie (we laten de weg scrollen, niet de bus)
    y: canvas.height / 2 - 20, // midden
    width: 60,
    height: 40,
    color: 'orange',
    speed: 5
  };

  // Hier slaan we achtergrondobjecten, pickups en obstakels op
  let obstacles = [];
  let pickups = [];
  let backgroundObjects = []; // Voor bijvoorbeeld bomen, wolken enz.

  // -----------------------------------------------
  // Besturing (pijltjestoetsen)
  // -----------------------------------------------
  let keys = {};

  window.addEventListener('keydown', function(e) {
    keys[e.key] = true;
  });

  window.addEventListener('keyup', function(e) {
    keys[e.key] = false;
  });

  // -----------------------------------------------
  // Functies voor Start, Pauze en Reset
  // -----------------------------------------------
  function startGame() {
    if (!gameRunning) {
      gameRunning = true;
      gamePaused = false;
      gameLoop();
    } else {
      // Als het spel al gestart is, haal je alleen de pauze eraf
      gamePaused = false;
    }
  }

  function pauseGame() {
    gamePaused = true;
  }

  function resetGame() {
    // Reset alle waarden naar beginsituatie
    gameRunning = false;
    gamePaused = false;
    score = 0;
    level = 1;
    frames = 0;
    speedMultiplier = 1;

    bus.x = 100;
    bus.y = canvas.height / 2 - bus.height / 2;

    obstacles = [];
    pickups = [];
    backgroundObjects = [];

    updateScoreBoard();

    // Na reset niet meteen starten, zodat je handmatig op Start kunt drukken
    drawStartScreen();
  }

  // -----------------------------------------------
  // Logica voor level en score
  // -----------------------------------------------
  function increaseScore(amount) {
    score += amount;
    // Elke X punten -> level omhoog
    if (score > 0 && score % 10 === 0) {
      levelUp();
    }
    updateScoreBoard();
  }

  function levelUp() {
    level++;
    speedMultiplier += 0.2; // Maak spel iets sneller
  }

  function updateScoreBoard() {
    document.getElementById('scoreValue').textContent = score;
    document.getElementById('levelValue').textContent = level;
  }

  // -----------------------------------------------
  // Spawnen van objecten (pickups en obstakels)
  // -----------------------------------------------
  function spawnObstacle() {
    // Obstakel komt van rechts met een random y
    const size = 30;
    obstacles.push({
      x: canvas.width + 50,
      y: Math.random() * (canvas.height - size),
      width: size,
      height: size,
      color: 'red',
      speed: 3 * speedMultiplier
    });
  }

  function spawnPickup() {
    // Pickup komt van rechts met een random y
    const radius = 10;
    pickups.push({
      x: canvas.width + 50,
      y: Math.random() * (canvas.height - radius * 2) + radius,
      radius: radius,
      color: 'green',
      speed: 3 * speedMultiplier
    });
  }

  // -----------------------------------------------
  // Achtergrondobjecten (bomen, wolken e.d.)
  // -----------------------------------------------
  // We maken simpele wolkjes/bomen op random posities
  function spawnBackgroundObject() {
    // Type bepalen: wolk of boom
    // Wolk = lichte kleur, boom = groener
    const isCloud = Math.random() < 0.5;
    if (isCloud) {
      backgroundObjects.push({
        x: canvas.width + 50,
        y: Math.random() * 100,
        width: 60,
        height: 30,
        color: 'white',
        speed: 1.5 * speedMultiplier,
        type: 'cloud'
      });
    } else {
      backgroundObjects.push({
        x: canvas.width + 50,
        y: canvas.height - 80, // Plaats boom onderaan
        width: 20,
        height: 60,
        color: 'green',
        speed: 2 * speedMultiplier,
        type: 'tree'
      });
    }
  }

  // -----------------------------------------------
  // Gameloop
  // -----------------------------------------------
  function gameLoop() {
    if (!gameRunning) return;
    if (gamePaused) {
      // Als het spel gepauzeerd is, niet updaten maar wel blijven “wachten”
      requestAnimationFrame(gameLoop);
      return;
    }

    update();
    draw();

    requestAnimationFrame(gameLoop);
  }

  // -----------------------------------------------
  // Updaten van posities
  // -----------------------------------------------
  function update() {
    frames++;

    // Besturing bus (pijltjes omhoog/omlaag/links/rechts)
    if (keys['ArrowUp']) {
      bus.y -= bus.speed;
    }
    if (keys['ArrowDown']) {
      bus.y += bus.speed;
    }
    if (keys['ArrowLeft']) {
      bus.x -= bus.speed;
    }
    if (keys['ArrowRight']) {
      bus.x += bus.speed;
    }

    // Zorg dat de bus binnen het canvas blijft
    if (bus.y < 0) bus.y = 0;
    if (bus.y + bus.height > canvas.height) {
      bus.y = canvas.height - bus.height;
    }
    if (bus.x < 0) bus.x = 0;
    if (bus.x + bus.width > canvas.width) {
      bus.x = canvas.width - bus.width;
    }

    // Achtergrondobjecten spawnen (niet te vaak)
    if (frames % 120 === 0) {
      spawnBackgroundObject();
    }
    // Obstakel spawnen
    if (frames % 90 === 0) {
      spawnObstacle();
    }
    // Pickup spawnen
    if (frames % 60 === 0) {
      spawnPickup();
    }

    // Update backgroundObjects
    backgroundObjects.forEach((obj) => {
      obj.x -= obj.speed;
    });
    // Verwijder objecten die uit beeld zijn
    backgroundObjects = backgroundObjects.filter(obj => obj.x + obj.width > 0);

    // Update obstacles
    obstacles.forEach((obs) => {
      obs.x -= obs.speed;
    });
    obstacles = obstacles.filter(obs => obs.x + obs.width > 0);

    // Update pickups
    pickups.forEach((pick) => {
      pick.x -= pick.speed;
    });
    pickups = pickups.filter(pick => pick.x + pick.radius > 0);

    // Check collisions bus - obstakel
    obstacles.forEach((obs) => {
      if (isColliding(bus, obs)) {
        // Bij botsing direct spel stoppen of score verminderen
        // Voor nu: Stop spel.
        gameRunning = false;
        alert('Je hebt een obstakel geraakt! Game over. Score: ' + score);
        resetGame();
      }
    });

    // Check collisions bus - pickup
    pickups.forEach((pick, index) => {
      if (isCollidingCircle(bus, pick)) {
        // Score omhoog
        increaseScore(1);
        // Verwijder pickup
        pickups.splice(index, 1);
      }
    });
  }

  // -----------------------------------------------
  // Teken alles op canvas
  // -----------------------------------------------
  function draw() {
    // Canvas schoonmaken
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1) Teken de “weg” als bewegende baan
    //    We doen alsof er een 'weg' is onderin het canvas, plus een zon en lucht
    drawBackground();

    // 2) Teken achtergrondobjecten (wolken, bomen etc.)
    backgroundObjects.forEach((obj) => {
      ctx.fillStyle = obj.color;
      if (obj.type === 'cloud') {
        // Wolk simpel tekenen als rechthoek of een paar ellipsen
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
      } else {
        // Een 'boom'
        ctx.fillRect(obj.x, obj.y, obj.width, obj.height);
      }
    });

    // 3) Teken pickups (dakdekkersmaterialen)
    pickups.forEach((pick) => {
      ctx.beginPath();
      ctx.arc(pick.x, pick.y, pick.radius, 0, Math.PI * 2);
      ctx.fillStyle = pick.color;
      ctx.fill();
      ctx.closePath();
    });

    // 4) Teken obstakels
    obstacles.forEach((obs) => {
      ctx.fillStyle = obs.color;
      ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
    });

    // 5) Teken de oranje bus
    ctx.fillStyle = bus.color;
    ctx.fillRect(bus.x, bus.y, bus.width, bus.height);
  }

  // Tekent simpelweg een lucht, zon, weg en evt. wat bomen langs de weg.
  function drawBackground() {
    // Lucht is al body achtergrond, maar we herhalen hier
    // Teken de zon
    ctx.beginPath();
    ctx.arc(70, 70, 40, 0, Math.PI * 2);
    ctx.fillStyle = 'yellow';
    ctx.fill();

    // Teken wolken? Gaan we nu via backgroundObjects doen, dus laten we achterwege

    // Teken weg (grijze rechthoek onderin)
    const roadHeight = 80;
    ctx.fillStyle = '#666';
    ctx.fillRect(0, canvas.height - roadHeight, canvas.width, roadHeight);

    // Teken een groene strook boven de weg
    ctx.fillStyle = 'green';
    ctx.fillRect(0, canvas.height - roadHeight - 30, canvas.width, 30);
  }

  // -----------------------------------------------
  // Botsingsdetectie
  // -----------------------------------------------
  // Rechthoek-rechthoek
  function isColliding(rect1, rect2) {
    return (
      rect1.x < rect2.x + rect2.width &&
      rect1.x + rect1.width > rect2.x &&
      rect1.y < rect2.y + rect2.height &&
      rect1.y + rect1.height > rect2.y
    );
  }

  // Rechthoek-cirkel
  function isCollidingCircle(rect, circle) {
    // Vind dichtstbijzijnde punt op rect bij de center van de cirkel
    let distX = Math.abs(circle.x - (rect.x + rect.width / 2));
    let distY = Math.abs(circle.y - (rect.y + rect.height / 2));

    // Als afstand op x-as groter is dan helft breedte rect + radius, geen botsing
    if (distX > (rect.width / 2 + circle.radius)) return false;
    // Idem op y-as
    if (distY > (rect.height / 2 + circle.radius)) return false;

    // Als afstand kleiner is dan de helft van de rect, botsing
    if (distX <= (rect.width / 2)) return true;
    if (distY <= (rect.height / 2)) return true;

    // Anders check de hoeken
    let dx = distX - rect.width / 2;
    let dy = distY - rect.height / 2;
    return (dx * dx + dy * dy <= (circle.radius * circle.radius));
  }

  // -----------------------------------------------
  // Startscherm tekenen als spel niet gestart is
  // -----------------------------------------------
  function drawStartScreen() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBackground();

    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#fff';
    ctx.font = '30px Arial';
    ctx.fillText('Welkom bij het Verkoelen Dakspecialiste Game!', 70, 180);
    ctx.font = '20px Arial';
    ctx.fillText('Klik op "Start" om te beginnen.', 240, 220);
  }

  // -----------------------------------------------
  // Initialiseren
  // -----------------------------------------------
  resetGame(); // Dit tekent ook gelijk het startscherm
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dakbedekking Berekening</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #FFFFFF;
            color: #333;
            font-size: 18px;
        }
        header {
            background-color: #F28C38;
            color: white;
            text-align: center;
            padding: 20px 0;
        }
        main {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        form {
            background-color: #D3D3D3;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 300px;
        }
        h3 {
            color: #F28C38;
            margin-top: 0;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input, select {
            width: calc(50% - 10px);
            padding: 10px;
            margin: 5px 5px;
            border: 1px solid #F28C38;
            border-radius: 3px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background-color: #F28C38;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #E07B30;
        }
        #resultaat {
            margin: 0;
            padding: 20px;
            background-color: #FFFFFF;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 300px;
        }
        #schetsContainer {
            flex: 100%;
            text-align: center;
        }
        #schets {
            border: none;
            max-width: 100%;
            background-color: #FFFFFF;
            margin-top: 10px;
        }
        #legenda {
            margin-top: 10px;
            font-size: 14px;
        }
        @media (max-width: 600px) {
            input, select {
                width: 100%;
                margin: 5px 0;
            }
            main {
                flex-direction: column;
            }
            #schets {
                width: 100%;
                height: auto;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>Dakbedekking Berekening</h1>
    </header>
    <main>
        <form id="dakForm">
            <h3>Invoer Dakgegevens</h3>
            <label>Naam dakbedekking:</label><br>
            <input type="text" id="dakNaam" placeholder="Bijv. Derbigum SP"><br>
            <label>Baanafmetingen (m):</label><br>
            <input type="number" id="baanLengte" placeholder="Lengte" step="0.01" required>
            <input type="number" id="baanBreedte" placeholder="Breedte" step="0.01" required><br>
            <label>Overlap (mm):</label><br>
            <input type="number" id="kopOverlap" placeholder="Kop" step="1" required>
            <input type="number" id="langsOverlap" placeholder="Langs" step="1" required><br>
            <label>Sluitbaan (mm, alleen blok):</label><br>
            <input type="number" id="sluitbaanBreedte" placeholder="Breedte" step="1" value="1000">
            <input type="number" id="sluitbaanOverlap" placeholder="Overlap" step="1" value="100"><br>
            <label>Dakvlak (m):</label><br>
            <input type="number" id="dakLengte" placeholder="Lengte" step="0.01" required>
            <input type="number" id="dakBreedte" placeholder="Breedte" step="0.01" required><br>
            <label>Minimale restlengte (m):</label><br>
            <input type="number" id="minRestLengte" placeholder="Min. lengte" step="0.01" value="0.3"><br>
            <label>Verband:</label>
            <select id="verband">
                <option value="halfsteens">Halfsteensverband</option>
                <option value="blok">Blokverband</option>
            </select><br>
            <button type="button" onclick="vulVoorbeeld()">Vul voorbeeld</button>
            <button type="button" onclick="exportPNG()">Export PNG</button>
            <button type="button" onclick="exportPDF()">Export PDF</button>
            <button type="button" onclick="window.print()">Print</button>
        </form>
        <div id="resultaat"></div>
        <div id="schetsContainer">
            <canvas id="schets" width="400" height="300"></canvas>
            <div id="legenda">
                <span style="color: red;">■</span> Dakvlak (rood) |
                <span style="color: #D3D3D3;">■</span> Banen (lichtgrijs)
            </div>
        </div>
    </main>
    <script>
        const { jsPDF } = window.jspdf;

        function vulVoorbeeld() {
            document.getElementById('dakNaam').value = 'Derbigum SP';
            document.getElementById('baanLengte').value = 4;
            document.getElementById('baanBreedte').value = 1;
            document.getElementById('kopOverlap').value = 150;
            document.getElementById('langsOverlap').value = 100;
            document.getElementById('sluitbaanBreedte').value = 1000;
            document.getElementById('sluitbaanOverlap').value = 100;
            document.getElementById('dakLengte').value = 10;
            document.getElementById('dakBreedte').value = 5;
            document.getElementById('minRestLengte').value = 0.3;
            document.getElementById('verband').value = 'halfsteens';
            updateBerekening();
        }

        function exportPNG() {
            html2canvas(document.getElementById('schets')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'dak_schets.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        function exportPDF() {
            html2canvas(document.body).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const width = pdf.internal.pageSize.getWidth();
                const height = pdf.internal.pageSize.getHeight();
                pdf.addImage(imgData, 'PNG', 0, 0, width, height);
                pdf.save('dak_berekening.pdf');
            });
        }

        function updateBerekening() {
            const dakNaam = document.getElementById('dakNaam').value || 'Onbekend';
            const baanLengte = parseFloat(document.getElementById('baanLengte').value) || 0;
            const baanBreedte = parseFloat(document.getElementById('baanBreedte').value) || 0;
            const kopOverlap = parseFloat(document.getElementById('kopOverlap').value) / 1000 || 0; // mm naar m
            const langsOverlap = parseFloat(document.getElementById('langsOverlap').value) / 1000 || 0; // mm naar m
            const sluitbaanBreedte = parseFloat(document.getElementById('sluitbaanBreedte').value) / 1000 || 0; // mm naar m
            const sluitbaanOverlap = parseFloat(document.getElementById('sluitbaanOverlap').value) / 1000 || 0; // mm naar m
            const dakLengte = parseFloat(document.getElementById('dakLengte').value) || 0;
            const dakBreedte = parseFloat(document.getElementById('dakBreedte').value) || 0;
            const minRestLengte = parseFloat(document.getElementById('minRestLengte').value) || 0;
            const verband = document.getElementById('verband').value;

            // Validatie
            if ([baanLengte, baanBreedte, kopOverlap, langsOverlap, dakLengte, dakBreedte, minRestLengte].some(val => val <= 0)) {
                document.getElementById('resultaat').innerHTML = 'Vul alle velden in met een positief getal!';
                return;
            }
            if (kopOverlap >= baanLengte || langsOverlap >= baanBreedte || sluitbaanBreedte <= sluitbaanOverlap) {
                document.getElementById('resultaat').innerHTML = 'Overlap mag niet groter zijn dan de baanafmetingen!';
                return;
            }

            // Berekeningen
            const effectieveBaanLengte = baanLengte - (verband === 'halfsteens' ? kopOverlap : 0);
            const effectieveBaanBreedte = baanBreedte - langsOverlap;
            const nettoDakOppervlakte = dakLengte * dakBreedte;

            let aantalBanenLengte, aantalBanenBreedte, materiaalOppervlakte, overlapOppervlakte, snijverlies;

            if (verband === 'halfsteens') {
                aantalBanenBreedte = Math.ceil(dakBreedte / effectieveBaanBreedte);
                aantalBanenLengte = 0;
                let totaleBaanLengte = 0;
                const banenPerRij = [];
                for (let i = 0; i < aantalBanenBreedte; i++) {
                    let resterendeLengte = dakLengte;
                    let banenInRij = 0;
                    while (resterendeLengte >= effectieveBaanLengte) {
                        banenInRij++;
                        resterendeLengte -= effectieveBaanLengte;
                    }
                    if (resterendeLengte >= minRestLengte) {
                        banenInRij++;
                        totaleBaanLengte += resterendeLengte + kopOverlap;
                    } else {
                        totaleBaanLengte += banenInRij * baanLengte;
                    }
                    banenPerRij.push(banenInRij);
                    aantalBanenLengte = Math.max(aantalBanenLengte, banenInRij);
                }
                materiaalOppervlakte = totaleBaanLengte * baanBreedte;
                overlapOppervlakte = (aantalBanenBreedte * kopOverlap * dakBreedte) + (langsOverlap * dakLengte * aantalBanenBreedte);
                snijverlies = materiaalOppervlakte - nettoDakOppervlakte - overlapOppervlakte;
            } else { // blokverband
                aantalBanenBreedte = Math.ceil(dakBreedte / effectieveBaanBreedte);
                aantalBanenLengte = Math.ceil(dakLengte / (sluitbaanBreedte - sluitbaanOverlap));
                materiaalOppervlakte = (aantalBanenBreedte * baanLengte * baanBreedte) + (aantalBanenLengte * sluitbaanBreedte * dakBreedte);
                overlapOppervlakte = (aantalBanenBreedte * langsOverlap * baanLengte) + (aantalBanenLengte * sluitbaanOverlap * dakBreedte);
                snijverlies = materiaalOppervlakte - nettoDakOppervlakte - overlapOppervlakte;
            }

            const overlapFactor = (materiaalOppervlakte / nettoDakOppervlakte).toFixed(2);

            // Resultaat weergeven
            document.getElementById('resultaat').innerHTML = `
                <strong>Resultaat (${dakNaam}):</strong><br>
                Dakoppervlakte: ${nettoDakOppervlakte.toFixed(2)} m²<br>
                Materiaaloppervlakte: ${materiaalOppervlakte.toFixed(2)} m²<br>
                Overlap: ${overlapOppervlakte.toFixed(2)} m²<br>
                Snijverlies: ${snijverlies.toFixed(2)} m² (reststukken kleiner dan ${minRestLengte}m)<br>
                Overlapfactor: ${overlapFactor}
            `;

            // Schets tekenen
            tekenSchets(dakLengte, dakBreedte, baanLengte, baanBreedte, kopOverlap, langsOverlap, sluitbaanBreedte, sluitbaanOverlap, verband, aantalBanenBreedte, aantalBanenLengte, minRestLengte);
        }

        function tekenSchets(dakLengte, dakBreedte, baanLengte, baanBreedte, kopOverlap, langsOverlap, sluitbaanBreedte, sluitbaanOverlap, verband, aantalBanenBreedte, aantalBanenLengte, minRestLengte) {
            const canvas = document.getElementById('schets');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Schaal berekenen
            const schaal = Math.min(380 / dakLengte, 280 / dakBreedte);
            const cDakLengte = dakLengte * schaal;
            const cDakBreedte = dakBreedte * schaal;
            const cBaanLengte = baanLengte * schaal;
            const cBaanBreedte = baanBreedte * schaal;
            const cKopOverlap = kopOverlap * schaal;
            const cLangsOverlap = langsOverlap * schaal;
            const cSluitbaanBreedte = sluitbaanBreedte * schaal;
            const cSluitbaanOverlap = sluitbaanOverlap * schaal;
            const cMinRestLengte = minRestLengte * schaal;

            // Dakvlak tekenen
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 3;
            ctx.strokeRect(10, 10, cDakLengte, cDakBreedte);

            // Banen tekenen
            ctx.fillStyle = '#D3D3D3';
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 1;
            const effectieveBaanLengte = cBaanLengte - (verband === 'halfsteens' ? cKopOverlap : 0);
            const effectieveBaanBreedte = cBaanBreedte - cLangsOverlap;

            if (verband === 'halfsteens') {
                for (let i = 0; i < aantalBanenBreedte; i++) {
                    let xOffset = 10 + (i % 2) * (effectieveBaanLengte / 2);
                    let resterendeLengte = dakLengte;
                    let j = 0;
                    while (resterendeLengte >= effectieveBaanLengte) {
                        ctx.fillRect(xOffset + j * effectieveBaanLengte, 10 + i * effectieveBaanBreedte, cBaanLengte, cBaanBreedte);
                        ctx.strokeRect(xOffset + j * effectieveBaanLengte, 10 + i * effectieveBaanBreedte, cBaanLengte, cBaanBreedte);
                        resterendeLengte -= effectieveBaanLengte;
                        j++;
                    }
                    if (resterendeLengte >= minRestLengte) {
                        ctx.fillRect(xOffset + j * effectieveBaanLengte, 10 + i * effectieveBaanBreedte, resterendeLengte * schaal + cKopOverlap, cBaanBreedte);
                        ctx.strokeRect(xOffset + j * effectieveBaanLengte, 10 + i * effectieveBaanBreedte, resterendeLengte * schaal + cKopOverlap, cBaanBreedte);
                    }
                }
            } else { // blokverband
                for (let i = 0; i < aantalBanenBreedte; i++) {
                    ctx.fillRect(10, 10 + i * effectieveBaanBreedte, cBaanLengte, cBaanBreedte);
                    ctx.strokeRect(10, 10 + i * effectieveBaanBreedte, cBaanLengte, cBaanBreedte);
                }
                const effectieveSluitbaanLengte = cSluitbaanBreedte - cSluitbaanOverlap;
                for (let j = 0; j < aantalBanenLengte; j++) {
                    ctx.fillRect(10 + j * effectieveSluitbaanLengte, 10, cSluitbaanBreedte, cDakBreedte);
                    ctx.strokeRect(10 + j * effectieveSluitbaanLengte, 10, cSluitbaanBreedte, cDakBreedte);
                }
            }

            // Labels
            ctx.fillStyle = '#F28C38';
            ctx.font = '14px Arial';
            ctx.fillText(`Dak: ${dakLengte}m x ${dakBreedte}m`, 15, 25);
        }

        // Automatisch updaten bij invoer
        document.querySelectorAll('#dakForm input, #dakForm select').forEach(element => {
            element.addEventListener('input', updateBerekening);
        });

        // Initiële berekening
        updateBerekening();
    </script>
</body>
</html>
